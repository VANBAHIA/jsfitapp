    </style>

</head>
<body>
    <div class="app-container" id="app">
        <div class="status-bar">
            Editor de Treinos - Personal
        </div>
        
        <!-- Home View -->
        <div id="homeView" class="view">
            <div class="header">
                <div class="header-title">Meus Treinos</div>
                <input type="file" id="importInput" accept=".json" style="display: none;">
                <button class="header-action" onclick="document.getElementById('importInput').click()">
                    Importar
                </button>
            </div>
            
            <div class="content">
                <button class="btn-primary" onclick="createNewPlan()">
                    <span>‚ûï</span>
                    Criar Novo Plano
                </button>
                
                <div id="plansList"></div>
            </div>
        </div>
        
        <!-- Edit Plan View -->
        <div id="editPlanView" class="view hidden">
            <div class="header">
                <button class="header-back" onclick="goBack()">‚Äπ</button>
                <div class="header-title" id="editPlanTitle">Editar Plano</div>
                <button class="header-action" onclick="savePlan()">Salvar</button>
            </div>
            
            <div class="content">
                <form id="planForm">
                    <div class="card">
                        <div class="form-group">
                            <label class="form-label">Nome do Plano</label>
                            <input type="text" class="form-input" name="nome" required>
                        </div>
                        
                        <div class="form-row-3">
                            <div class="form-group">
                                <label class="form-label">Dias/Semana</label>
                                <input type="number" class="form-input" name="dias" min="1" max="7" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">In√≠cio</label>
                                <input type="date" class="form-input" name="dataInicio" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fim</label>
                                <input type="date" class="form-input" name="dataFim" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: 16px; font-size: 16px;">üë§ Perfil</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Idade</label>
                                <input type="number" class="form-input" name="idade" min="15" max="100">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Altura</label>
                                <input type="text" class="form-input" name="altura" placeholder="1,70m">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Peso</label>
                                <input type="text" class="form-input" name="peso" placeholder="70kg">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Porte</label>
                                <select class="form-input" name="porte">
                                    <option value="pequeno">Pequeno</option>
                                    <option value="medio">M√©dio</option>
                                    <option value="grande">Grande</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Objetivo</label>
                            <input type="text" class="form-input" name="objetivo" placeholder="Condicionamento geral">
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: 16px; font-size: 16px;">üìù Observa√ß√µes</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Frequ√™ncia</label>
                            <input type="text" class="form-input" name="frequencia" placeholder="3x por semana">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Progress√£o</label>
                            <input type="text" class="form-input" name="progressao" placeholder="Aumente a carga gradualmente">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Descanso</label>
                            <input type="text" class="form-input" name="descanso" placeholder="60-90 segundos entre s√©ries">
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Plan Details View -->
        <div id="planDetailsView" class="view hidden">
            <div class="header">
                <button class="header-back" onclick="goBack()">‚Äπ</button>
                <div class="header-title" id="planDetailsTitle">Detalhes do Plano</div>
                <button class="header-action" onclick="editCurrentPlan()">Editar</button>
            </div>
            
            <div class="content">
                <!-- Share ID Card -->
                <div id="shareIdCard" class="card share-id-card hidden">
                    <div class="share-id-content">
                        <div class="share-id-title">ID de Compartilhamento</div>
                        <div class="share-id-value" id="shareIdValue">------</div>
                        <div class="share-id-subtitle">Compartilhe este ID com seus alunos</div>
                    </div>
                </div>

                <!-- API Status -->
                <div id="apiStatus" class="api-status hidden">
                    Conectando com servidor...
                </div>

                <!-- Storage Status -->
                <div id="storageStatus" class="api-status">
                    Plano n√£o compartilhado
                </div>

                <button class="btn-primary" onclick="createNewWorkout()">
                    <span>‚ûï</span>
                    Adicionar Treino
                </button>

                <button class="btn-primary btn-share" onclick="shareCurrentPlan()">
                    <span>üîó</span>
                    Gerar ID de Compartilhamento
                </button>

                <div id="copyIdSection" class="hidden" style="margin-top: 16px;">
                    <button class="btn-secondary" onclick="copyShareId()">
                        <span>üìã</span>
                        Copiar ID do Treino
                    </button>
                </div>
                
                <div id="workoutsList"></div>
            </div>
        </div>
        
        <!-- Edit Workout View -->
        <div id="editWorkoutView" class="view hidden">
            <div class="header">
                <button class="header-back" onclick="goBack()">‚Äπ</button>
                <div class="header-title" id="editWorkoutTitle">Editar Treino</div>
                <button class="header-action" onclick="saveWorkout()">Salvar</button>
            </div>
            
            <div class="content">
                <form id="workoutForm">
                    <div class="card">
                        <div class="form-group">
                            <label class="form-label">ID do Treino</label>
                            <input type="text" class="form-input" name="id" placeholder="A, B, C ou 1, 2, 3" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nome do Treino</label>
                            <input type="text" class="form-input" name="nome" placeholder="A - Peito e Tr√≠ceps" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Foco do Treino</label>
                            <input type="text" class="form-input" name="foco" placeholder="Membros superiores - Empurrar">
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Workout Details View -->
        <div id="workoutDetailsView" class="view hidden">
            <div class="header">
                <button class="header-back" onclick="goBack()">‚Äπ</button>
                <div class="header-title" id="workoutDetailsTitle">Exerc√≠cios</div>
                <button class="header-action" onclick="editCurrentWorkout()">Editar</button>
            </div>
            
            <div class="content">
                <button class="btn-primary" onclick="createNewExercise()">
                    <span>‚ûï</span>
                    Adicionar Exerc√≠cio
                </button>
                
                <div id="exercisesList"></div>
            </div>
        </div>
        
        <!-- Edit Exercise View -->
        <div id="editExerciseView" class="view hidden">
            <div class="header">
                <button class="header-back" onclick="goBack()">‚Äπ</button>
                <div class="header-title" id="editExerciseTitle">Editar Exerc√≠cio</div>
                <button class="header-action" onclick="saveExercise()">Salvar</button>
            </div>
            
            <div class="content">
                <form id="exerciseForm">
                    <div class="card">
                        <div class="form-group">
                            <label class="form-label">Nome do Exerc√≠cio</label>
                            <input type="text" class="form-input" name="nome" placeholder="Supino Reto" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o</label>
                            <textarea class="form-input form-textarea" name="descricao" placeholder="Descri√ß√£o da execu√ß√£o do exerc√≠cio"></textarea>
                        </div>
                        
                        <div class="form-row-3">
                            <div class="form-group">
                                <label class="form-label">S√©ries</label>
                                <input type="number" class="form-input" name="series" min="1" max="10" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Repeti√ß√µes</label>
                                <input type="text" class="form-input" name="repeticoes" placeholder="12 ou 30s" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Carga</label>
                                <input type="text" class="form-input" name="carga" placeholder="20kg" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="safe-bottom"></div>
    </div>

    <script>
        // Configura√ß√£o da API atualizada para usar arquivos
        const API_CONFIG = {
            baseUrl: 'https://jsfitapp.netlify.app/api',
            timeout: 5000,
            retries: 3
        };

        // API para comunica√ß√£o com servidor usando arquivos JSON
        class WorkoutAPI {
            static async saveToServer(shareId, planData) {
                return new Promise(async (resolve, reject) => {
                    try {
                        showApiStatus('Salvando no servidor...', 'loading');
                        
                        const response = await fetch(`${API_CONFIG.baseUrl}/workouts`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                id: shareId,
                                originalId: planData.originalId,
                                plan: planData.plan,
                                timestamp: planData.timestamp,
                                version: planData.version
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`Erro HTTP: ${response.status}`);
                        }

                        const result = await response.json();
                        
                        if (result.success) {
                            console.log(`[API] Plano ${shareId} salvo no servidor`);
                            resolve({
                                success: true,
                                shareId: shareId,
                                serverUrl: `${API_CONFIG.baseUrl}/workouts/${shareId}`,
                                timestamp: result.timestamp,
                                fileSize: result.fileSize
                            });
                        } else {
                            throw new Error('Resposta de servidor inv√°lida');
                        }
                        
                    } catch (error) {
                        console.error('Erro ao salvar no servidor:', error);
                        reject(error);
                    }
                });
            }

            static async getFromServer(shareId) {
                return new Promise(async (resolve, reject) => {
                    try {
                        const response = await fetch(`${API_CONFIG.baseUrl}/workouts/${shareId}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`Erro HTTP: ${response.status}`);
                        }

                        const result = await response.json();
                        
                        if (result.success) {
                            console.log(`[API] Plano ${shareId} encontrado no servidor`);
                            resolve({
                                success: true,
                                data: result.data,
                                timestamp: result.data.timestamp
                            });
                        } else {
                            throw new Error('Plano n√£o encontrado');
                        }
                        
                    } catch (error) {
                        console.error('Erro ao buscar do servidor:', error);
                        reject(error);
                    }
                });
            }

            static async checkServerHealth() {
                try {
                    const response = await fetch(`${API_CONFIG.baseUrl}/health`);
                    const data = await response.json();
                    return data.status === 'online';
                } catch (error) {
                    console.error('Erro ao verificar servidor:', error);
                    return false;
                }
            }
        }

        // Estado da aplica√ß√£o
        let appState = {
            workoutPlans: [],
            currentView: 'home',
            selectedPlan: null,
            selectedWorkout: null,
            editingExercise: null,
            viewHistory: [],
            serverOnline: false
        };

        // Templates
        const newPlanTemplate = {
            id: Date.now(),
            shareId: null,
            nome: "Novo Plano",
            dias: 3,
            dataInicio: new Date().toISOString().split('T')[0],
            dataFim: new Date(Date.now() + 180 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
            perfil: {
                idade: 30,
                altura: "1,70m",
                peso: "70kg",
                porte: "medio",
                objetivo: "Condicionamento geral"
            },
            treinos: [],
            observacoes: {
                frequencia: "3x por semana",
                progressao: "Aumente a carga gradualmente",
                descanso: "60-90 segundos entre s√©ries",
                hidratacao: "Mantenha-se hidratado",
                adaptacao: "Primeiras semanas com cargas leves",
                consulta: "Consulte um profissional"
            }
        };

        const newWorkoutTemplate = {
            id: "",
            nome: "Novo Treino",
            foco: "Descri√ß√£o do foco",
            exercicios: [],
            concluido: false,
            execucoes: 0
        };

        const newExerciseTemplate = {
            id: Date.now(),
            nome: "Novo Exerc√≠cio",
            descricao: "Descri√ß√£o do exerc√≠cio",
            series: 3,
            repeticoes: "12",
            carga: "20kg",
            concluido: false
        };

        // Sistema de Compartilhamento
        function generateShareId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function copyShareId() {
            if (!appState.selectedPlan || !appState.selectedPlan.shareId) {
                alert('Nenhum ID de compartilhamento dispon√≠vel');
                return;
            }

            const shareId = appState.selectedPlan.shareId;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareId).then(() => {
                    const button = event.target.closest('button');
                    const originalText = button.innerHTML;
                    button.innerHTML = '<span>‚úÖ</span>ID Copiado!';
                    button.style.background = '#34c759';
                    
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.background = '';
                    }, 2000);
                    
                    console.log(`ID ${shareId} copiado para √°rea de transfer√™ncia`);
                }).catch(err => {
                    fallbackCopyTextToClipboard(shareId);
                });
            } else {
                fallbackCopyTextToClipboard(shareId);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert(`ID ${text} copiado para √°rea de transfer√™ncia!`);
                } else {
                    alert(`ID de compartilhamento: ${text}\n\nCopie este ID manualmente`);
                }
            } catch (err) {
                alert(`ID de compartilhamento: ${text}\n\nCopie este ID manualmente`);
            }
            
            document.body.removeChild(textArea);
        }

        async function shareCurrentPlan() {
            if (!appState.selectedPlan) return;

            showApiStatus('Verificando servidor...', 'loading');

            try {
                // Verificar se servidor est√° online
                const serverOnline = await WorkoutAPI.checkServerHealth();
                appState.serverOnline = serverOnline;

                if (!serverOnline) {
                    showApiStatus('‚ö†Ô∏è Servidor offline - salvando apenas localmente', 'error');
                }

                // Gerar ID se n√£o existir
                if (!appState.selectedPlan.shareId) {
                    appState.selectedPlan.shareId = generateShareId();
                    
                    const planIndex = appState.workoutPlans.findIndex(p => p.id === appState.selectedPlan.id);
                    if (planIndex >= 0) {
                        appState.workoutPlans[planIndex] = appState.selectedPlan;
                    }
                    
                    saveToLocalStorage();
                }

                // Preparar dados para envio
                const planDataForServer = {
                    id: appState.selectedPlan.shareId,
                    originalId: appState.selectedPlan.id,
                    plan: {
                        ...appState.selectedPlan,
                        treinos: appState.selectedPlan.treinos.map(treino => ({
                            ...treino,
                            concluido: false,
                            execucoes: 0,
                            exercicios: treino.exercicios.map(ex => ({
                                ...ex,
                                concluido: false
                            }))
                        }))
                    },
                    timestamp: new Date().toISOString(),
                    version: "1.0"
                };

                if (serverOnline) {
                    // Tentar salvar no servidor
                    showApiStatus('Enviando para servidor...', 'loading');
                    
                    const serverResponse = await WorkoutAPI.saveToServer(
                        appState.selectedPlan.shareId, 
                        planDataForServer
                    );

                    if (serverResponse.success) {
                        saveSharedPlan(appState.selectedPlan);
                        
                        showApiStatus(
                            `‚úÖ Plano salvo no servidor! ID: ${appState.selectedPlan.shareId}`, 
                            'success'
                        );
                        
                        document.getElementById('copyIdSection').classList.remove('hidden');
                    }
                } else {
                    // Salvar apenas localmente
                    saveSharedPlan(appState.selectedPlan);
                    
                    showApiStatus(
                        `‚ö†Ô∏è Servidor offline. ID salvo localmente: ${appState.selectedPlan.shareId}`, 
                        'error'
                    );
                    
                    document.getElementById('copyIdSection').classList.remove('hidden');
                }

                renderPlanDetails();

            } catch (error) {
                console.error('Erro ao compartilhar plano:', error);
                
                if (appState.selectedPlan.shareId) {
                    saveSharedPlan(appState.selectedPlan);
                }
                
                showApiStatus(
                    `‚ùå Erro no servidor. ID salvo localmente: ${appState.selectedPlan.shareId}`, 
                    'error'
                );
                
                document.getElementById('copyIdSection').classList.remove('hidden');
                renderPlanDetails();
            }
        }

        function showApiStatus(message, type) {
            const apiStatus = document.getElementById('apiStatus');
            const storageStatus = document.getElementById('storageStatus');
            
            apiStatus.textContent = message;
            apiStatus.className = `api-status ${type}`;
            apiStatus.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    apiStatus.classList.add('hidden');
                }, type === 'success' ? 3000 : 5000);
            }
            
            if (type === 'success') {
                storageStatus.textContent = '‚úÖ Plano dispon√≠vel no servidor';
                storageStatus.className = 'api-status success';
            } else if (type === 'error') {
                storageStatus.textContent = '‚ö†Ô∏è Problema na sincroniza√ß√£o com servidor';
                storageStatus.className = 'api-status error';
            }
        }

        function saveSharedPlan(plan) {
            try {
                const sharedData = {
                    id: plan.shareId,
                    originalId: plan.id,
                    plan: {
                        ...plan,
                        treinos: plan.treinos.map(treino => ({
                            ...treino,
                            concluido: false,
                            execucoes: 0,
                            exercicios: treino.exercicios.map(ex => ({
                                ...ex,
                                concluido: false
                            }))
                        }))
                    },
                    timestamp: new Date().toISOString(),
                    version: "1.0"
                };

                const sharedPlans = getSharedPlans();
                sharedPlans[plan.shareId] = sharedData;
                localStorage.setItem('sharedWorkoutPlans', JSON.stringify(sharedPlans));

                console.log('Plano compartilhado salvo localmente:', sharedData);
            } catch (error) {
                console.error('Erro ao salvar plano compartilhado:', error);
                alert('Erro ao gerar ID de compartilhamento');
            }
        }

        function getSharedPlans() {
            try {
                const stored = localStorage.getItem('sharedWorkoutPlans');
                return stored ? JSON.parse(stored) : {};
            } catch (error) {
                console.error('Erro ao carregar planos compartilhados:', error);
                return {};
            }
        }

        async function updateSharedPlan(plan) {
            if (plan.shareId && appState.serverOnline) {
                try {
                    showApiStatus('Sincronizando altera√ß√µes...', 'loading');
                    
                    const planDataForServer = {
                        id: plan.shareId,
                        originalId: plan.id,
                        plan: {
                            ...plan,
                            treinos: plan.treinos.map(treino => ({
                                ...treino,
                                concluido: false,
                                execucoes: 0,
                                exercicios: treino.exercicios.map(ex => ({
                                    ...ex,
                                    concluido: false
                                }))
                            }))
                        },
                        timestamp: new Date().toISOString(),
                        version: "1.0"
                    };

                    await WorkoutAPI.saveToServer(plan.shareId, planDataForServer);
                    showApiStatus('‚úÖ Altera√ß√µes sincronizadas', 'success');
                    
                } catch (error) {
                    console.error('Erro ao sincronizar com servidor:', error);
                    showApiStatus('‚ö†Ô∏è Erro na sincroniza√ß√£o, salvo localmente', 'error');
                }
                
                saveSharedPlan(plan);
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', async function() {
            loadFromLocalStorage();
            
            // Verificar servidor
            appState.serverOnline = await WorkoutAPI.checkServerHealth();
            
            renderCurrentView();
            
            // Configurar import
            document.getElementById('importInput').addEventListener('change', importJSON);
            
            // Prevenir zoom no iOS
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });

        // Navega√ß√£o
        function showView(viewName) {
            appState.viewHistory.push(appState.currentView);
            appState.currentView = viewName;
            renderCurrentView();
        }

        function goBack() {
            if (appState.viewHistory.length > 0) {
                appState.currentView = appState.viewHistory.pop();
                renderCurrentView();
            }
        }

        function renderCurrentView() {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });

            const currentViewElement = document.getElementById(appState.currentView + 'View');
            if (currentViewElement) {
                currentViewElement.classList.remove('hidden');
                currentViewElement.classList.add('slide-enter');
                
                setTimeout(() => {
                    currentViewElement.classList.remove('slide-enter');
                }, 300);
            }

            switch (appState.currentView) {
                case 'home':
                    renderPlansList();
                    break;
                case 'editPlan':
                    renderEditPlan();
                    break;
                case 'planDetails':
                    renderPlanDetails();
                    break;
                case 'editWorkout':
                    renderEditWorkout();
                    break;
                case 'workoutDetails':
                    renderWorkoutDetails();
                    break;
                case 'editExercise':
                    renderEditExercise();
                    break;
            }
        }

        // Renderiza√ß√£o de views (fun√ß√µes simplificadas - as mesmas do arquivo original)
        function renderPlansList() {
            const container = document.getElementById('plansList');
            
            if (appState.workoutPlans.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üèãÔ∏è‚Äç‚ôÇÔ∏è</div>
                        <div class="empty-title">Nenhum plano criado</div>
                        <div class="empty-subtitle">Crie seu primeiro plano de treino para come√ßar</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = appState.workoutPlans.map(plan => `
                <div class="card plan-card">
                    <div class="plan-header">
                        <div>
                            <div class="plan-title">${plan.nome}</div>
                            <div class="plan-subtitle">${plan.dias} dias ‚Ä¢ ${plan.treinos.length} treinos</div>
                            <div class="plan-date">${plan.dataInicio} at√© ${plan.dataFim}</div>
                            ${plan.shareId ? `<div class="plan-date" style="color: #34c759; font-weight: 600;">üîó ID: ${plan.shareId}</div>` : ''}
                        </div>
                        <div class="plan-actions">
                            <button class="action-btn" onclick="duplicatePlan(${plan.id})" title="Duplicar">üìã</button>
                            <button class="action-btn" onclick="exportJSON(${plan.id})" title="Exportar">‚¨áÔ∏è</button>
                            <button class="action-btn success" onclick="editPlan(${plan.id})" title="Editar">‚úèÔ∏è</button>
                            <button class="action-btn danger" onclick="deletePlan(${plan.id})" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </div>
                    
                    <div class="workout-preview">
                        ${plan.treinos.slice(0, 4).map(treino => `
                            <div class="workout-item">
                                <div class="workout-name">${treino.nome}</div>
                                <div class="workout-count">${treino.exercicios.length} exerc√≠cios</div>
                            </div>
                        `).join('')}
                        ${plan.treinos.length > 4 ? `
                            <div class="workout-item" style="text-align: center; color: #8e8e93;">
                                +${plan.treinos.length - 4} treinos
                            </div>
                        ` : ''}
                    </div>
                    
                    <button class="btn-primary" style="margin-top: 12px;" onclick="viewPlanDetails(${plan.id})">
                        Ver Detalhes
                    </button>
                </div>
            `).join('');
        }

        function renderPlanDetails() {
            const title = document.getElementById('planDetailsTitle');
            const container = document.getElementById('workoutsList');
            const shareIdCard = document.getElementById('shareIdCard');
            const shareIdValue = document.getElementById('shareIdValue');
            const storageStatus = document.getElementById('storageStatus');
            const copyIdSection = document.getElementById('copyIdSection');
            
            if (appState.selectedPlan) {
                title.textContent = appState.selectedPlan.nome;

                if (appState.selectedPlan.shareId) {
                    shareIdCard.classList.remove('hidden');
                    shareIdValue.textContent = appState.selectedPlan.shareId;
                    copyIdSection.classList.remove('hidden');
                    
                    const localShared = getSharedPlans()[appState.selectedPlan.shareId];
                    
                    if (appState.serverOnline && localShared) {
                        storageStatus.textContent = `‚úÖ Plano dispon√≠vel no servidor (ID: ${appState.selectedPlan.shareId})`;
                        storageStatus.className = 'api-status success';
                    } else if (localShared) {
                        storageStatus.textContent = `‚ö†Ô∏è Plano salvo localmente, servidor offline`;
                        storageStatus.className = 'api-status error';
                    } else {
                        storageStatus.textContent = `‚ö†Ô∏è ID gerado mas n√£o sincronizado`;
                        storageStatus.className = 'api-status error';
                    }
                } else {
                    shareIdCard.classList.add('hidden');
                    copyIdSection.classList.add('hidden');
                    storageStatus.textContent = "Plano n√£o compartilhado";
                    storageStatus.className = 'api-status';
                }
                
                if (appState.selectedPlan.treinos.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üí™</div>
                            <div class="empty-title">Nenhum treino adicionado</div>
                            <div class="empty-subtitle">Adicione treinos para completar seu plano</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = appState.selectedPlan.treinos.map(treino => `
                    <div class="card">
                        <div class="plan-header">
                            <div>
                                <div class="plan-title">${treino.nome}</div>
                                <div class="plan-subtitle">${treino.foco}</div>
                                <div class="plan-date">${treino.exercicios.length} exerc√≠cios</div>
                            </div>
                            <div class="plan-actions">
                                <button class="action-btn" onclick="viewWorkoutDetails('${treino.id}')" title="Ver exerc√≠cios">üëÅÔ∏è</button>
                                <button class="action-btn success" onclick="editWorkout('${treino.id}')" title="Editar">‚úèÔ∏è</button>
                                <button class="action-btn danger" onclick="deleteWorkout('${treino.id}')" title="Excluir">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="workout-preview">
                            ${treino.exercicios.slice(0, 4).map(exercicio => `
                                <div class="workout-item">
                                    <div class="workout-name">${exercicio.nome}</div>
                                    <div class="workout-count">${exercicio.series}x${exercicio.repeticoes} ‚Ä¢ ${exercicio.carga}</div>
                                </div>
                            `).join('')}
                            ${treino.exercicios.length > 4 ? `
                                <div class="workout-item" style="text-align: center; color: #8e8e93;">
                                    +${treino.exercicios.length - 4} exerc√≠cios
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // Implementar outras fun√ß√µes de renderiza√ß√£o e CRUD seguindo o mesmo padr√£o...
        // (Por brevidade, vou incluir apenas as principais)

        function createNewPlan() {
            appState.selectedPlan = { ...newPlanTemplate, id: Date.now() };
            showView('editPlan');
        }

        function savePlan() {
            const form = document.getElementById('planForm');
            const formData = new FormData(form);
            
            const updatedPlan = {
                ...appState.selectedPlan,
                nome: formData.get('nome'),
                dias: parseInt(formData.get('dias')),
                dataInicio: formData.get('dataInicio'),
                dataFim: formData.get('dataFim'),
                perfil: {
                    idade: parseInt(formData.get('idade')),
                    altura: formData.get('altura'),
                    peso: formData.get('peso'),
                    porte: formData.get('porte'),
                    objetivo: formData.get('objetivo')
                },
                observacoes: {
                    ...appState.selectedPlan.observacoes,
                    frequencia: formData.get('frequencia'),
                    progressao: formData.get('progressao'),
                    descanso: formData.get('descanso')
                }
            };

            const existingIndex = appState.workoutPlans.findIndex(p => p.id === updatedPlan.id);
            if (existingIndex >= 0) {
                appState.workoutPlans[existingIndex] = updatedPlan;
            } else {
                appState.workoutPlans.push(updatedPlan);
            }

            appState.selectedPlan = updatedPlan;
            
            updateSharedPlan(updatedPlan);
            
            saveToLocalStorage();
            showView('planDetails');
        }

        function saveToLocalStorage() {
            try {
                localStorage.setItem('workoutPlansPersonal', JSON.stringify(appState.workoutPlans));
            } catch (error) {
                console.error('Erro ao salvar no localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('workoutPlansPersonal');
                if (saved) {
                    appState.workoutPlans = JSON.parse(saved);
                }
            } catch (error) {
                console.error('Erro ao carregar do localStorage:', error);
                appState.workoutPlans = [];
            }
        }

        // Implementar outras fun√ß√µes necess√°rias...
        // (As demais fun√ß√µes seguem o mesmo padr√£o do arquivo original)
        
        function renderEditPlan() {
            const form = document.getElementById('planForm');
            const title = document.getElementById('editPlanTitle');
            
            if (appState.selectedPlan) {
                title.textContent = appState.selectedPlan.nome === "Novo Plano" ? 'Criar Plano' : 'Editar Plano';
                
                form.nome.value = appState.selectedPlan.nome || '';
                form.dias.value = appState.selectedPlan.dias || 3;
                form.dataInicio.value = appState.selectedPlan.dataInicio || '';
                form.dataFim.value = appState.selectedPlan.dataFim || '';
                form.idade.value = appState.selectedPlan.perfil?.idade || 30;
                form.altura.value = appState.selectedPlan.perfil?.altura || '1,70m';
                form.peso.value = appState.selectedPlan.perfil?.peso || '70kg';
                form.porte.value = appState.selectedPlan.perfil?.porte || 'medio';
                form.objetivo.value = appState.selectedPlan.perfil?.objetivo || 'Condicionamento geral';
                form.frequencia.value = appState.selectedPlan.observacoes?.frequencia || '3x por semana';
                form.progressao.value = appState.selectedPlan.observacoes?.progressao || 'Aumente a carga gradualmente';
                form.descanso.value = appState.selectedPlan.observacoes?.descanso || '60-90 segundos entre s√©ries';
            }
        }

        // Adicionar demais fun√ß√µes b√°sicas de CRUD...
        function editPlan(planId) {
            appState.selectedPlan = appState.workoutPlans.find(p => p.id === planId);
            showView('editPlan');
        }

        function viewPlanDetails(planId) {
            appState.selectedPlan = appState.workoutPlans.find(p => p.id === planId);
            showView('planDetails');
        }

        function editCurrentPlan() {
            showView('editPlan');
        }

        function createNewWorkout() {
            appState.selectedWorkout = { ...newWorkoutTemplate, id: `${appState.selectedPlan.treinos.length + 1}` };
            showView('editWorkout');
        }

        // Outras fun√ß√µes de renderiza√ß√£o e CRUD seguem o mesmo padr√£o do arquivo original...

    </script>
</body>
</html><!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Editor Treinos">
    <title>Editor de Treinos - Personal</title>
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIHJ4PSI0MCIgZmlsbD0iIzc5NDVmZiIvPjxwYXRoIGQ9Im05MCA0NWMtMjQuODUzIDAtNDUgMjAuMTQ3LTQ1IDQ1djQ1YzAgMjQuODUzIDIwLjE0NyA0NSA0NSA0NXM0NS0yMC4xNDcgNDUtNDV2LTQ1YzAtMjQuODUzLTIwLjE0Ny00NS00NS00NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+">
    
    <link rel="stylesheet" type="text/css" href="css/stylepersonal.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.4;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .status-bar {
            background: #8b5cf6;
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .header {
            background: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e5e5e7;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-back {
            background: none;
            border: none;
            font-size: 24px;
            color: #007aff;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
            flex: 1;
            text-align: center;
        }

        .header-action {
            background: #007aff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .content {
            padding: 20px;
        }

        .view {
            transition: transform 0.3s ease;
        }

        .view.hidden {
            display: none;
        }

        .view.slide-enter {
            transform: translateX(100%);
            animation: slideIn 0.3s ease forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateX(0);
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .btn-primary {
            background: linear-gradient(135deg, #007aff, #0056cc);
            color: white;
            border: none;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary.btn-share {
            background: linear-gradient(135deg, #34c759, #28a745);
        }

        .btn-secondary {
            background: #f2f2f7;
            color: #1d1d1f;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8e8e93;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1d1d1f;
        }

        .empty-subtitle {
            font-size: 14px;
            line-height: 1.5;
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .plan-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .plan-subtitle {
            font-size: 14px;
            color: #8e8e93;
            margin-bottom: 2px;
        }

        .plan-date {
            font-size: 12px;
            color: #8e8e93;
        }

        .plan-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: #f2f2f7;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn.success {
            background: #d4edda;
            color: #155724;
        }

        .action-btn.danger {
            background: #f8d7da;
            color: #721c24;
        }

        .workout-preview {
            display: grid;
            gap: 8px;
            margin-bottom: 16px;
        }

        .workout-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f2f2f7;
            border-radius: 8px;
            font-size: 14px;
        }

        .workout-name {
            font-weight: 500;
        }

        .workout-count {
            color: #8e8e93;
            font-size: 12px;
        }

        .exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: white;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }

        .exercise-info {
            flex: 1;
        }

        .exercise-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .exercise-details {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #8e8e93;
        }

        .exercise-actions {
            display: flex;
            gap: 8px;
        }

        /* Share ID Card Styles */
        .share-id-card {
            background: linear-gradient(135deg, #34c759, #28a745);
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .share-id-content {
            padding: 10px 0;
        }

        .share-id-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .share-id-value {
            font-size: 32px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            letter-spacing: 4px;
            margin-bottom: 8px;
        }

        .share-id-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }

        /* API Status Styles */
        .api-status {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
            background: #f2f2f7;
            color: #8e8e93;
        }

        .api-status.loading {
            background: #e3f2fd;
            color: #1565c0;
        }

        .api-status.success {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .api-status.error {
            background: #ffebee;
            color: #c62828;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .plan-header {
                flex-direction: column;
                gap: 12px;
            }
            
            .plan-actions {
                align-self: flex-end;
            }
        }

        .safe-bottom {
            height: 20px;
        }
    </style>