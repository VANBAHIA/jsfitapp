<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="JS Fit App">
    <title>JS Fit App - Criador de Planos de Treino</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzc5NDVmZiIvPgo8cGF0aCBkPSJtMTYgOGMtNC40MTggMC04IDMuNTgyLTggOHY4YzAgNC40MTggMy41ODIgOCA4IDhzOC0zLjU4MiA4LTh2LThjMC00LjQxOC0zLjU4Mi04LTgtOHoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #7945ff, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .main-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7945ff, #667eea);
            box-shadow: 0 4px 15px rgba(121, 69, 255, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(121, 69, 255, 0.6);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #48bb78, #38b2ac);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6);
        }
        
        .btn-outline {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-input, .form-select, .form-textarea {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #7945ff;
            box-shadow: 0 0 0 3px rgba(121, 69, 255, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .plan-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .plan-type-btn {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }
        
        .plan-type-btn.active {
            border-color: #7945ff;
            background: linear-gradient(135deg, #7945ff, #667eea);
            color: white;
        }
        
        .plan-type-btn:hover:not(.active) {
            border-color: #7945ff;
            transform: translateY(-2px);
        }
        
        .workout-editor {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .workout-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }
        
        .exercise-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .exercise-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .exercise-info {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
            align-items: center;
        }
        
        .exercise-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 0.85rem;
            border-radius: 8px;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c53030;
        }
        
        .import-export {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #7945ff, #667eea);
            transition: width 0.3s ease;
        }
        
        .success-message {
            background: linear-gradient(135deg, #48bb78, #38b2ac);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .error-message {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .exercise-info {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .exercise-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .exercise-actions {
                justify-content: center;
            }
        }
        
        .floating-action {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7945ff, #667eea);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(121, 69, 255, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(121, 69, 255, 0.6);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🏋️ JS Fit App</h1>
            <p>Criador de Planos de Treino Personalizados</p>
            <div class="main-actions">
                <button class="btn btn-primary" onclick="showPlanCreator()">
                    ➕ Novo Plano
                </button>
                <button class="btn btn-secondary" onclick="showPlanList()">
                    📋 Meus Planos
                </button>
                <label class="btn btn-outline" for="importFile">
                    📁 Importar Plano
                </label>
            </div>
        </header>

        <div id="planCreator" class="content-card" style="display: none;">
            <div class="form-section">
                <h2>👤 Dados do Aluno</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Aluno</label>
                        <input type="text" id="studentName" class="form-input" placeholder="Digite o nome completo">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Idade</label>
                        <input type="number" id="studentAge" class="form-input" placeholder="25" min="15" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura</label>
                        <input type="text" id="studentHeight" class="form-input" placeholder="1,75m">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso</label>
                        <input type="text" id="studentWeight" class="form-input" placeholder="75kg">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>🎯 Configurações do Plano</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Plano</label>
                        <input type="text" id="planName" class="form-input" placeholder="Plano Hipertrofia 2024">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Objetivo</label>
                        <select id="planObjective" class="form-select">
                            <option value="Hipertrofia e ganho de massa muscular">Hipertrofia e ganho de massa muscular</option>
                            <option value="Condicionamento geral">Condicionamento geral</option>
                            <option value="Perda de peso">Perda de peso</option>
                            <option value="Definição muscular">Definição muscular</option>
                            <option value="Força">Ganho de força</option>
                            <option value="Resistência">Resistência</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Início</label>
                        <input type="date" id="planStartDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Fim</label>
                        <input type="date" id="planEndDate" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Observações Gerais</label>
                    <textarea id="planObservations" class="form-textarea" placeholder="Digite observações importantes sobre o plano de treino..."></textarea>
                </div>
            </div>

            <div class="form-section">
                <h2>📅 Tipo de Plano</h2>
                <div class="plan-type-selector">
                    <div class="plan-type-btn active" onclick="selectPlanType(1, 'A')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">A</div>
                        <div style="font-size: 0.9rem;">1 Dia</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(2, 'AB')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">AB</div>
                        <div style="font-size: 0.9rem;">2 Dias</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(3, 'ABC')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">ABC</div>
                        <div style="font-size: 0.9rem;">3 Dias</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(4, 'ABCD')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">ABCD</div>
                        <div style="font-size: 0.9rem;">4 Dias</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(5, 'ABCDE')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">ABCDE</div>
                        <div style="font-size: 0.9rem;">5 Dias</div>
                    </div>
                </div>
            </div>

            <div id="workoutEditor">
                <!-- Workouts will be generated here -->
            </div>

            <div class="import-export">
                <button class="btn btn-primary" onclick="savePlan()">
                    💾 Salvar Plano
                </button>
                <button class="btn btn-secondary" onclick="exportPlan()">
                    📤 Exportar JSON
                </button>
                <button class="btn btn-outline" onclick="shareToServer()">
                    🔗 Compartilhar
                </button>
            </div>
        </div>

        <div id="planList" class="content-card">
            <h2>📋 Meus Planos de Treino</h2>
            <div id="planListContent">
                <!-- Plans will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal for Exercise Editor -->
    <div id="exerciseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>✏️ Editar Exercício</h2>
                <button class="close-btn" onclick="closeExerciseModal()">&times;</button>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Nome do Exercício</label>
                    <input type="text" id="exerciseName" class="form-input" placeholder="Supino Reto">
                </div>
                <div class="form-group">
                    <label class="form-label">Séries</label>
                    <input type="number" id="exerciseSets" class="form-input" placeholder="4" min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Repetições</label>
                    <input type="text" id="exerciseReps" class="form-input" placeholder="8-12">
                </div>
                <div class="form-group">
                    <label class="form-label">Carga</label>
                    <input type="text" id="exerciseWeight" class="form-input" placeholder="80kg">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Descrição/Técnica</label>
                <textarea id="exerciseDescription" class="form-textarea" placeholder="Instruções técnicas do exercício..."></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveExercise()">💾 Salvar</button>
                <button class="btn btn-outline" onclick="closeExerciseModal()">❌ Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="importFile" class="file-input" accept=".json" onchange="importPlan(event)">

    <!-- Floating Action Button -->
    <button class="floating-action" onclick="scrollToTop()" title="Voltar ao topo">
        ↑
    </button>

    <script>
        // Application State
        let currentPlan = {
            id: null,
            nome: '',
            aluno: {
                nome: '',
                idade: 25,
                altura: '1,75m',
                peso: '75kg'
            },
            dias: 1,
            dataInicio: '',
            dataFim: '',
            perfil: {
                objetivo: 'Hipertrofia e ganho de massa muscular'
            },
            observacoes: {
                frequencia: '',
                progressao: 'Aumente a carga gradualmente quando conseguir completar todas as repetições',
                descanso: '60-90 segundos entre séries',
                hidratacao: 'Mantenha-se bem hidratado',
                alimentacao: 'Siga uma dieta balanceada',
                suplementacao: 'Consulte um nutricionista',
                sono: '7-9 horas de sono por noite',
                aquecimento: 'Sempre faça aquecimento antes do treino',
                tecnica: 'Priorize a execução correta',
                periodizacao: 'Varie o treino periodicamente',
                consulta: 'Acompanhamento profissional recomendado'
            },
            treinos: []
        };

        let savedPlans = [];
        let currentExerciseIndex = null;
        let currentWorkoutIndex = null;

        // API Configuration (from personal.js)
        const API_CONFIG = {
            baseUrl: 'https://jsfitapp.netlify.app/api',
            timeout: 5000,
            retries: 3
        };

        // Default workout templates
        const workoutTemplates = {
            A: { nome: 'A - Corpo Inteiro', foco: 'Treino completo' },
            B: { nome: 'B - Corpo Inteiro', foco: 'Treino completo alternativo' },
            C: { nome: 'C - Corpo Inteiro', foco: 'Treino de força' },
            D: { nome: 'D - Membros Inferiores', foco: 'Pernas e glúteos' },
            E: { nome: 'E - Core e Cardio', foco: 'Abdômen e condicionamento' }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedPlans();
            setDefaultDates();
            showPlanList();
        });

        function setDefaultDates() {
            const today = new Date();
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + 6);
            
            document.getElementById('planStartDate').value = today.toISOString().split('T')[0];
            document.getElementById('planEndDate').value = endDate.toISOString().split('T')[0];
        }

        function showPlanCreator() {
            document.getElementById('planCreator').style.display = 'block';
            document.getElementById('planList').style.display = 'none';
            resetPlanForm();
            selectPlanType(1, 'A');
        }

        function showPlanList() {
            document.getElementById('planCreator').style.display = 'none';
            document.getElementById('planList').style.display = 'block';
            renderPlanList();
        }

        function resetPlanForm() {
            currentPlan = {
                id: Date.now(),
                nome: '',
                aluno: { nome: '', idade: 25, altura: '1,75m', peso: '75kg' },
                dias: 1,
                dataInicio: '',
                dataFim: '',
                perfil: { objetivo: 'Hipertrofia e ganho de massa muscular' },
                observacoes: {
                    frequencia: '',
                    progressao: 'Aumente a carga gradualmente quando conseguir completar todas as repetições',
                    descanso: '60-90 segundos entre séries',
                    hidratacao: 'Mantenha-se bem hidratado',
                    alimentacao: 'Siga uma dieta balanceada',
                    suplementacao: 'Consulte um nutricionista',
                    sono: '7-9 horas de sono por noite',
                    aquecimento: 'Sempre faça aquecimento antes do treino',
                    tecnica: 'Priorize a execução correta',
                    periodizacao: 'Varie o treino periodicamente',
                    consulta: 'Acompanhamento profissional recomendado'
                },
                treinos: []
            };
            
            // Clear form fields
            document.getElementById('studentName').value = '';
            document.getElementById('studentAge').value = '';
            document.getElementById('studentHeight').value = '';
            document.getElementById('studentWeight').value = '';
            document.getElementById('planName').value = '';
            document.getElementById('planObjective').value = 'Hipertrofia e ganho de massa muscular';
            document.getElementById('planObservations').value = '';
            setDefaultDates();
        }

        function selectPlanType(days, letters) {
            // Update active button
            document.querySelectorAll('.plan-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.plan-type-btn').classList.add('active');
            
            currentPlan.dias = days;
            generateWorkouts(days, letters);
        }

        function generateWorkouts(days, letters) {
            const workoutEditor = document.getElementById('workoutEditor');
            currentPlan.treinos = [];
            
            let html = '<div class="form-section"><h2>🏋️ Configuração dos Treinos</h2>';
            
            for (let i = 0; i < days; i++) {
                const letter = letters[i];
                const template = workoutTemplates[letter] || { nome: `${letter} - Treino ${i + 1}`, foco: 'Treino personalizado' };
                
                const workout = {
                    id: letter,
                    nome: template.nome,
                    foco: template.foco,
                    exercicios: [],
                    concluido: false,
                    execucoes: 0
                };
                
                currentPlan.treinos.push(workout);
                
                html += `
                    <div class="workout-editor">
                        <div class="workout-header">
                            <div class="workout-title">${letter} - ${template.nome}</div>
                            <button class="btn btn-small btn-primary" onclick="addExercise(${i})">➕ Adicionar Exercício</button>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nome do Treino</label>
                                <input type="text" class="form-input" value="${template.nome}" onchange="updateWorkoutName(${i}, this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Foco do Treino</label>
                                <input type="text" class="form-input" value="${template.foco}" onchange="updateWorkoutFocus(${i}, this.value)">
                            </div>
                        </div>
                        <div class="exercise-list" id="exerciseList${i}">
                            <!-- Exercises will be added here -->
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            workoutEditor.innerHTML = html;
        }

        function updateWorkoutName(index, name) {
            if (currentPlan.treinos[index]) {
                currentPlan.treinos[index].nome = name;
            }
        }

        function updateWorkoutFocus(index, focus) {
            if (currentPlan.treinos[index]) {
                currentPlan.treinos[index].foco = focus;
            }
        }

        function addExercise(workoutIndex) {
            currentWorkoutIndex = workoutIndex;
            currentExerciseIndex = null;
            
            // Clear modal form
            document.getElementById('exerciseName').value = '';
            document.getElementById('exerciseSets').value = '';
            document.getElementById('exerciseReps').value = '';
            document.getElementById('exerciseWeight').value = '';
            document.getElementById('exerciseDescription').value = '';
            
            document.getElementById('exerciseModal').classList.add('active');
        }

        function editExercise(workoutIndex, exerciseIndex) {
            currentWorkoutIndex = workoutIndex;
            currentExerciseIndex = exerciseIndex;
            
            const exercise = currentPlan.treinos[workoutIndex].exercicios[exerciseIndex];
            
            // Fill modal form
            document.getElementById('exerciseName').value = exercise.nome;
            document.getElementById('exerciseSets').value = exercise.series;
            document.getElementById('exerciseReps').value = exercise.repeticoes;
            document.getElementById('exerciseWeight').value = exercise.carga;
            document.getElementById('exerciseDescription').value = exercise.descricao || '';
            
            document.getElementById('exerciseModal').classList.add('active');
        }

        function saveExercise() {
            const exercise = {
                id: Date.now() + Math.random(),
                nome: document.getElementById('exerciseName').value,
                series: parseInt(document.getElementById('exerciseSets').value),
                repeticoes: document.getElementById('exerciseReps').value,
                carga: document.getElementById('exerciseWeight').value,
                descricao: document.getElementById('exerciseDescription').value,
                concluido: false
            };

            if (!exercise.nome || !exercise.series || !exercise.repeticoes || !exercise.carga) {
                showMessage('Por favor, preencha todos os campos obrigatórios', 'error');
                return;
            }

            if (currentExerciseIndex !== null) {
                // Edit existing exercise
                currentPlan.treinos[currentWorkoutIndex].exercicios[currentExerciseIndex] = exercise;
            } else {
                // Add new exercise
                currentPlan.treinos[currentWorkoutIndex].exercicios.push(exercise);
            }

            closeExerciseModal();
            renderExerciseList(currentWorkoutIndex);
        }

        function deleteExercise(workoutIndex, exerciseIndex) {
            if (confirm('Tem certeza que deseja excluir este exercício?')) {
                currentPlan.treinos[workoutIndex].exercicios.splice(exerciseIndex, 1);
                renderExerciseList(workoutIndex);
            }
        }

        function renderExerciseList(workoutIndex) {
            const exerciseList = document.getElementById(`exerciseList${workoutIndex}`);
            const exercises = currentPlan.treinos[workoutIndex].exercicios;

            if (exercises.length === 0) {
                exerciseList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Nenhum exercício adicionado ainda</p>';
                return;
            }

            let html = '';
            exercises.forEach((exercise, index) => {
                html += `
                    <div class="exercise-item">
                        <div class="exercise-info">
                            <div>
                                <strong>${exercise.nome}</strong>
                                ${exercise.descricao ? `<br><small style="color: #666;">${exercise.descricao}</small>` : ''}
                            </div>
                            <div>${exercise.series} séries</div>
                            <div>${exercise.repeticoes} reps</div>
                            <div>${exercise.carga}</div>
                        </div>
                        <div class="exercise-actions">
                            <button class="btn btn-small btn-secondary" onclick="editExercise(${workoutIndex}, ${index})">✏️</button>
                            <button class="btn btn-small btn-danger" onclick="deleteExercise(${workoutIndex}, ${index})">🗑️</button>
                        </div>
                    </div>
                `;
            });

            exerciseList.innerHTML = html;
        }

        function closeExerciseModal() {
            document.getElementById('exerciseModal').classList.remove('active');
        }

        function savePlan() {
            // Get form data
            currentPlan.aluno.nome = document.getElementById('studentName').value;
            currentPlan.aluno.idade = parseInt(document.getElementById('studentAge').value) || 25;
            currentPlan.aluno.altura = document.getElementById('studentHeight').value || '1,75m';
            currentPlan.aluno.peso = document.getElementById('studentWeight').value || '75kg';
            currentPlan.nome = document.getElementById('planName').value;
            currentPlan.perfil.objetivo = document.getElementById('planObjective').value;
            currentPlan.dataInicio = document.getElementById('planStartDate').value;
            currentPlan.dataFim = document.getElementById('planEndDate').value;
            
            const observations = document.getElementById('planObservations').value;
            if (observations) {
                currentPlan.observacoes.frequencia = observations;
            }

            // Validation
            if (!currentPlan.aluno.nome || !currentPlan.nome) {
                showMessage('Por favor, preencha o nome do aluno e nome do plano', 'error');
                return;
            }

            // Check if plan has exercises
            const hasExercises = currentPlan.treinos.some(workout => workout.exercicios.length > 0);
            if (!hasExercises) {
                if (!confirm('Este plano não possui exercícios. Deseja salvar mesmo assim?')) {
                    return;
                }
            }

            // Update plan in list or add new
            const existingIndex = savedPlans.findIndex(p => p.id === currentPlan.id);
            if (existingIndex >= 0) {
                savedPlans[existingIndex] = { ...currentPlan };
            } else {
                savedPlans.push({ ...currentPlan });
            }

            // Save to localStorage
            localStorage.setItem('jsfitapp_plans', JSON.stringify(savedPlans));
            
            showMessage('Plano salvo com sucesso!', 'success');
        }

        function exportPlan() {
            savePlan(); // Save current changes first
            
            // Create export format compatible with the original structure
            const exportData = {
                planos: [{
                    id: currentPlan.id,
                    nome: currentPlan.nome,
                    aluno: currentPlan.aluno,
                    dias: currentPlan.dias,
                    dataInicio: currentPlan.dataInicio,
                    dataFim: currentPlan.dataFim,
                    perfil: {
                        idade: currentPlan.aluno.idade,
                        altura: currentPlan.aluno.altura,
                        peso: currentPlan.aluno.peso,
                        porte: getPorteFisico(currentPlan.aluno.peso),
                        objetivo: currentPlan.perfil.objetivo
                    },
                    treinos: currentPlan.treinos.map(treino => ({
                        ...treino,
                        exercicios: treino.exercicios.map(ex => ({
                            ...ex,
                            concluido: false
                        })),
                        concluido: false,
                        execucoes: 0
                    })),
                    observacoes: currentPlan.observacoes
                }]
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = `plano-treino-${currentPlan.nome.toLowerCase().replace(/\s+/g, '-')}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            URL.revokeObjectURL(url);
            showMessage('Plano exportado com sucesso!', 'success');
        }

        function shareToServer() {
            savePlan(); // Save current changes first
            
            if (!currentPlan.nome || !currentPlan.aluno.nome) {
                showMessage('Salve o plano antes de compartilhar', 'error');
                return;
            }

            // Generate share ID
            const shareId = generateShareId();
            
            // Prepare data for server
            const serverData = {
                id: shareId,
                originalId: currentPlan.id,
                plan: {
                    ...currentPlan,
                    shareId: shareId,
                    treinos: currentPlan.treinos.map(treino => ({
                        ...treino,
                        exercicios: treino.exercicios.map(ex => ({
                            ...ex,
                            concluido: false
                        })),
                        concluido: false,
                        execucoes: 0
                    }))
                },
                timestamp: new Date().toISOString(),
                version: "1.0"
            };

            // Try to save to server
            fetch(`${API_CONFIG.baseUrl}/workouts`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(serverData)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    // Copy share ID to clipboard
                    copyToClipboard(shareId);
                    showMessage(`Plano compartilhado! ID: ${shareId} (copiado para área de transferência)`, 'success');
                } else {
                    throw new Error('Erro do servidor');
                }
            })
            .catch(error => {
                console.error('Erro ao compartilhar:', error);
                // Still save locally and show ID
                copyToClipboard(shareId);
                showMessage(`ID gerado localmente: ${shareId} (copiado para área de transferência)`, 'success');
            });
        }

        function generateShareId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        function importPlan(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    let planData;

                    // Handle different JSON formats
                    if (data.planos && Array.isArray(data.planos) && data.planos.length > 0) {
                        planData = data.planos[0];
                    } else if (data.plan) {
                        planData = data.plan;
                    } else {
                        planData = data;
                    }

                    // Convert to our format
                    currentPlan = {
                        id: Date.now(),
                        nome: planData.nome + ' - Importado',
                        aluno: {
                            nome: planData.aluno?.nome || 'Aluno Importado',
                            idade: planData.perfil?.idade || planData.aluno?.idade || 25,
                            altura: planData.perfil?.altura || planData.aluno?.altura || '1,75m',
                            peso: planData.perfil?.peso || planData.aluno?.peso || '75kg'
                        },
                        dias: planData.dias || 1,
                        dataInicio: planData.dataInicio || new Date().toISOString().split('T')[0],
                        dataFim: planData.dataFim || new Date(Date.now() + 180 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        perfil: {
                            objetivo: planData.perfil?.objetivo || 'Hipertrofia e ganho de massa muscular'
                        },
                        observacoes: planData.observacoes || {
                            frequencia: 'Plano importado',
                            progressao: 'Aumente a carga gradualmente',
                            descanso: '60-90 segundos entre séries',
                            hidratacao: 'Mantenha-se bem hidratado',
                            alimentacao: 'Siga uma dieta balanceada',
                            suplementacao: 'Consulte um nutricionista',
                            sono: '7-9 horas de sono por noite',
                            aquecimento: 'Sempre faça aquecimento antes do treino',
                            tecnica: 'Priorize a execução correta',
                            periodizacao: 'Varie o treino periodicamente',
                            consulta: 'Acompanhamento profissional recomendado'
                        },
                        treinos: planData.treinos ? planData.treinos.map(treino => ({
                            id: treino.id,
                            nome: treino.nome,
                            foco: treino.foco,
                            exercicios: treino.exercicios ? treino.exercicios.map(ex => ({
                                id: ex.id || Date.now() + Math.random(),
                                nome: ex.nome,
                                descricao: ex.descricao || '',
                                series: ex.series || 3,
                                repeticoes: ex.repeticoes || '12',
                                carga: ex.carga || '20kg',
                                concluido: false
                            })) : [],
                            concluido: false,
                            execucoes: 0
                        })) : []
                    };

                    // Fill form with imported data
                    fillFormWithPlan(currentPlan);
                    showPlanCreator();
                    showMessage('Plano importado com sucesso!', 'success');

                } catch (error) {
                    console.error('Erro ao importar:', error);
                    showMessage('Erro ao importar arquivo. Verifique o formato.', 'error');
                }
            };

            reader.readAsText(file);
            event.target.value = '';
        }

        function fillFormWithPlan(plan) {
            document.getElementById('studentName').value = plan.aluno.nome;
            document.getElementById('studentAge').value = plan.aluno.idade;
            document.getElementById('studentHeight').value = plan.aluno.altura;
            document.getElementById('studentWeight').value = plan.aluno.peso;
            document.getElementById('planName').value = plan.nome;
            document.getElementById('planObjective').value = plan.perfil.objetivo;
            document.getElementById('planStartDate').value = plan.dataInicio;
            document.getElementById('planEndDate').value = plan.dataFim;
            document.getElementById('planObservations').value = plan.observacoes.frequencia || '';

            // Update plan type selector
            selectPlanType(plan.dias, ['A', 'B', 'C', 'D', 'E'].slice(0, plan.dias).join(''));
            
            // Render exercises for each workout
            plan.treinos.forEach((workout, index) => {
                renderExerciseList(index);
            });
        }

        function renderPlanList() {
            const container = document.getElementById('planListContent');
            
            if (savedPlans.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">📋</div>
                        <h3>Nenhum plano salvo</h3>
                        <p>Crie seu primeiro plano de treino</p>
                    </div>
                `;
                return;
            }

            let html = '<div style="display: grid; gap: 20px;">';
            
            savedPlans.forEach((plan, index) => {
                const totalExercises = plan.treinos.reduce((sum, workout) => sum + workout.exercicios.length, 0);
                
                html += `
                    <div style="background: white; border-radius: 15px; padding: 20px; border: 2px solid #e2e8f0;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h3 style="margin: 0 0 5px 0; color: #333;">${plan.nome}</h3>
                                <p style="margin: 0; color: #666;">👤 ${plan.aluno.nome} • ${plan.aluno.idade} anos</p>
                                <p style="margin: 5px 0 0 0; color: #666;">📅 ${plan.dias} dias • ${totalExercises} exercícios</p>
                                <p style="margin: 5px 0 0 0; color: #7945ff; font-weight: 600;">${plan.perfil.objetivo}</p>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-small btn-secondary" onclick="editPlan(${index})" title="Editar">✏️</button>
                                <button class="btn btn-small btn-primary" onclick="duplicatePlan(${index})" title="Duplicar">📋</button>
                                <button class="btn btn-small btn-outline" onclick="exportSavedPlan(${index})" title="Exportar">📤</button>
                                <button class="btn btn-small btn-danger" onclick="deletePlan(${index})" title="Excluir">🗑️</button>
                            </div>
                        </div>
                        <div style="background: #f8fafc; border-radius: 8px; padding: 15px;">
                            <h4 style="margin: 0 0 10px 0; font-size: 0.9rem; color: #666;">Treinos:</h4>
                            ${plan.treinos.map(workout => 
                                `<div style="margin-bottom: 5px;"><strong>${workout.nome}</strong> - ${workout.exercicios.length} exercícios</div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function editPlan(index) {
            currentPlan = { ...savedPlans[index] };
            fillFormWithPlan(currentPlan);
            showPlanCreator();
        }

        function duplicatePlan(index) {
            const original = savedPlans[index];
            currentPlan = {
                ...original,
                id: Date.now(),
                nome: original.nome + ' - Cópia'
            };
            fillFormWithPlan(currentPlan);
            showPlanCreator();
            showMessage('Plano duplicado! Faça as alterações necessárias.', 'success');
        }

        function exportSavedPlan(index) {
            const plan = savedPlans[index];
            
            const exportData = {
                planos: [{
                    id: plan.id,
                    nome: plan.nome,
                    aluno: plan.aluno,
                    dias: plan.dias,
                    dataInicio: plan.dataInicio,
                    dataFim: plan.dataFim,
                    perfil: {
                        idade: plan.aluno.idade,
                        altura: plan.aluno.altura,
                        peso: plan.aluno.peso,
                        porte: getPorteFisico(plan.aluno.peso),
                        objetivo: plan.perfil.objetivo
                    },
                    treinos: plan.treinos,
                    observacoes: plan.observacoes
                }]
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = `plano-treino-${plan.nome.toLowerCase().replace(/\s+/g, '-')}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            URL.revokeObjectURL(url);
            showMessage('Plano exportado com sucesso!', 'success');
        }

        function deletePlan(index) {
            if (confirm('Tem certeza que deseja excluir este plano? Esta ação não pode ser desfeita.')) {
                savedPlans.splice(index, 1);
                localStorage.setItem('jsfitapp_plans', JSON.stringify(savedPlans));
                renderPlanList();
                showMessage('Plano excluído com sucesso!', 'success');
            }
        }

        function loadSavedPlans() {
            try {
                const saved = localStorage.getItem('jsfitapp_plans');
                if (saved) {
                    savedPlans = JSON.parse(saved);
                }
            } catch (error) {
                console.error('Erro ao carregar planos:', error);
                savedPlans = [];
            }
        }

        function getPorteFisico(peso) {
            const weight = parseFloat(peso.replace('kg', ''));
            if (weight < 70) return 'pequeno';
            if (weight > 85) return 'grande';
            return 'medio';
        }

        function showMessage(message, type) {
            // Remove existing messages
            document.querySelectorAll('.success-message, .error-message').forEach(el => el.remove());
            
            const messageEl = document.createElement('div');
            messageEl.className = type === 'success' ? 'success-message' : 'error-message';
            messageEl.innerHTML = `
                <span>${type === 'success' ? '✅' : '❌'}</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 4000);
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Close modal when clicking outside
        document.getElementById('exerciseModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeExerciseModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeExerciseModal();
            }
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                savePlan();
            }
        });
    </script>
</body>
</html>
                