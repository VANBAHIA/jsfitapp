<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="JS Fit App">
    <title>JS Fit App - Criador de Planos de Treino</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzc5NDVmZiIvPgo8cGF0aCBkPSJtMTYgOGMtNC40MTggMC04IDMuNTgyLTggOHY4YzAgNC40MTggMy41ODIgOCA4IDhzOC0zLjU4MiA4LTh2LThjMC00LjQxOC0zLjU4Mi04LTgtOHoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #7945ff, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .main-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7945ff, #667eea);
            box-shadow: 0 4px 15px rgba(121, 69, 255, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(121, 69, 255, 0.6);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #48bb78, #38b2ac);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6);
        }
        
        .btn-ai {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-ai:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }
        
        .btn-outline {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-input, .form-select, .form-textarea {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #7945ff;
            box-shadow: 0 0 0 3px rgba(121, 69, 255, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .plan-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .plan-type-btn {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }
        
        .plan-type-btn.active {
            border-color: #7945ff;
            background: linear-gradient(135deg, #7945ff, #667eea);
            color: white;
        }
        
        .plan-type-btn:hover:not(.active) {
            border-color: #7945ff;
            transform: translateY(-2px);
        }
        
        .workout-editor {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .workout-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }
        
        .exercise-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .exercise-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .exercise-info {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
            align-items: center;
        }
        
        .exercise-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 0.85rem;
            border-radius: 8px;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c53030;
        }
        
        .import-export {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #7945ff, #667eea);
            transition: width 0.3s ease;
        }
        
        .success-message {
            background: linear-gradient(135deg, #48bb78, #38b2ac);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .error-message {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-form-section {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .ai-form-section h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-input {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .ai-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .ai-input:focus {
            border-color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.3);
        }
        
        .generating-indicator {
            display: none;
            text-align: center;
            padding: 30px;
            background: #f8fafc;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .generating-indicator.active {
            display: block;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid #7945ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .floating-action {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7945ff, #667eea);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(121, 69, 255, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(121, 69, 255, 0.6);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .exercise-info {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .exercise-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .exercise-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üèãÔ∏è JS Fit App</h1>
            <p>Criador de Planos de Treino Personalizados</p>
            <div class="main-actions">
                <button class="btn btn-primary" onclick="showPlanCreator()">
                    ‚ûï Novo Plano
                </button>
                <button class="btn btn-secondary" onclick="showPlanList()">
                    üìã Meus Planos
                </button>
                <button class="btn btn-ai" onclick="showAIPlanCreator()">
                    ü§ñ Criar com IA
                </button>
                <label class="btn btn-outline" for="importFile">
                    üìÅ Importar Plano
                </label>
            </div>
        </header>

        <!-- AI Plan Creator -->
        <div id="aiPlanCreator" class="content-card" style="display: none;">
            <div class="ai-form-section">
                <h3>ü§ñ Criador de Plano com IA</h3>
                <p>Preencha as informa√ß√µes b√°sicas e deixe a IA criar um plano personalizado para voc√™!</p>
            </div>

            <div class="form-section">
                <h2>üë§ Dados do Aluno</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Aluno</label>
                        <input type="text" id="aiStudentName" class="form-input" placeholder="Digite o nome completo">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Idade</label>
                        <input type="number" id="aiStudentAge" class="form-input" placeholder="25" min="15" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura</label>
                        <input type="text" id="aiStudentHeight" class="form-input" placeholder="1,75m">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso</label>
                        <input type="text" id="aiStudentWeight" class="form-input" placeholder="75kg">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>üéØ Configura√ß√µes do Plano</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Objetivo Principal</label>
                        <select id="aiPlanObjective" class="form-select">
                            <option value="Hipertrofia e ganho de massa muscular">Hipertrofia e ganho de massa muscular</option>
                            <option value="Perda de peso e defini√ß√£o">Perda de peso e defini√ß√£o</option>
                            <option value="Condicionamento geral">Condicionamento geral</option>
                            <option value="For√ßa e pot√™ncia">For√ßa e pot√™ncia</option>
                            <option value="Resist√™ncia muscular">Resist√™ncia muscular</option>
                            <option value="Reabilita√ß√£o">Reabilita√ß√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">N√≠vel de Experi√™ncia</label>
                        <select id="aiExperienceLevel" class="form-select">
                            <option value="iniciante">Iniciante (0-6 meses)</option>
                            <option value="intermediario">Intermedi√°rio (6 meses - 2 anos)</option>
                            <option value="avancado">Avan√ßado (2+ anos)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dias Dispon√≠veis por Semana</label>
                        <select id="aiAvailableDays" class="form-select">
                            <option value="2">2 dias</option>
                            <option value="3" selected>3 dias</option>
                            <option value="4">4 dias</option>
                            <option value="5">5 dias</option>
                            <option value="6">6 dias</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tempo por Sess√£o (minutos)</label>
                        <select id="aiSessionTime" class="form-select">
                            <option value="45">45 minutos</option>
                            <option value="60" selected>60 minutos</option>
                            <option value="75">75 minutos</option>
                            <option value="90">90 minutos</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>üèãÔ∏è Prefer√™ncias de Treino</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Equipamentos Dispon√≠veis</label>
                        <select id="aiEquipment" class="form-select">
                            <option value="academia_completa">Academia Completa</option>
                            <option value="home_gym">Home Gym (Halteres + Barra)</option>
                            <option value="peso_corporal">Apenas Peso Corporal</option>
                            <option value="funcional">Equipamentos Funcionais</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Foco Muscular Preferido</label>
                        <select id="aiMusclePreference" class="form-select">
                            <option value="equilibrado">Desenvolvimento Equilibrado</option>
                            <option value="superior">Foco Membros Superiores</option>
                            <option value="inferior">Foco Membros Inferiores</option>
                            <option value="core">Foco Core e Funcional</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Limita√ß√µes ou Les√µes</label>
                    <textarea id="aiLimitations" class="form-textarea" placeholder="Descreva qualquer limita√ß√£o f√≠sica, les√£o pr√©via ou exerc√≠cio que deve ser evitado..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Observa√ß√µes Especiais</label>
                    <textarea id="aiSpecialNotes" class="form-textarea" placeholder="Exerc√≠cios preferidos, hor√°rios de treino, metas espec√≠ficas, etc..."></textarea>
                </div>
            </div>

            <div class="generating-indicator" id="generatingIndicator">
                <div class="spinner"></div>
                <h3>ü§ñ IA Criando Seu Plano...</h3>
                <p>Analisando suas informa√ß√µes e gerando o plano personalizado. Isso pode levar alguns segundos.</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
            </div>

            <div class="import-export">
                <button class="btn btn-ai" onclick="generateAIPlan()">
                    ü§ñ Gerar Plano com IA
                </button>
                <button class="btn btn-outline" onclick="showPlanCreator()">
                    üìù Criar Manualmente
                </button>
                <button class="btn btn-secondary" onclick="showPlanList()">
                    üìã Ver Meus Planos
                </button>
            </div>
        </div>

        <!-- Manual Plan Creator -->
        <div id="planCreator" class="content-card" style="display: none;">
            <div class="form-section">
                <h2>üë§ Dados do Aluno</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Aluno</label>
                        <input type="text" id="studentName" class="form-input" placeholder="Digite o nome completo">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Idade</label>
                        <input type="number" id="studentAge" class="form-input" placeholder="25" min="15" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura</label>
                        <input type="text" id="studentHeight" class="form-input" placeholder="1,75m">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso</label>
                        <input type="text" id="studentWeight" class="form-input" placeholder="75kg">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>üéØ Configura√ß√µes do Plano</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Plano</label>
                        <input type="text" id="planName" class="form-input" placeholder="Plano Hipertrofia 2024">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Objetivo</label>
                        <select id="planObjective" class="form-select">
                            <option value="Hipertrofia e ganho de massa muscular">Hipertrofia e ganho de massa muscular</option>
                            <option value="Condicionamento geral">Condicionamento geral</option>
                            <option value="Perda de peso">Perda de peso</option>
                            <option value="Defini√ß√£o muscular">Defini√ß√£o muscular</option>
                            <option value="For√ßa">Ganho de for√ßa</option>
                            <option value="Resist√™ncia">Resist√™ncia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de In√≠cio</label>
                        <input type="date" id="planStartDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Fim</label>
                        <input type="date" id="planEndDate" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes Gerais</label>
                    <textarea id="planObservations" class="form-textarea" placeholder="Digite observa√ß√µes importantes sobre o plano de treino..."></textarea>
                </div>
            </div>

            <div class="form-section">
                <h2>üìÖ Tipo de Plano</h2>
                <div class="plan-type-selector">
                    <div class="plan-type-btn active" onclick="selectPlanType(1, 'A')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">A</div>
                        <div style="font-size: 0.9rem;">1 Dia</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(2, 'AB')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">AB</div>
                        <div style="font-size: 0.9rem;">2 Dias</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(3, 'ABC')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">ABC</div>
                        <div style="font-size: 0.9rem;">3 Dias</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(4, 'ABCD')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">ABCD</div>
                        <div style="font-size: 0.9rem;">4 Dias</div>
                    </div>
                    <div class="plan-type-btn" onclick="selectPlanType(5, 'ABCDE')">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">ABCDE</div>
                        <div style="font-size: 0.9rem;">5 Dias</div>
                    </div>
                </div>
            </div>

            <div id="workoutEditor">
                <!-- Workouts will be generated here -->
            </div>

            <div class="import-export">
                <button class="btn btn-primary" onclick="savePlan()">
                    üíæ Salvar Plano
                </button>
                <button class="btn btn-secondary" onclick="exportPlan()">
                    üì§ Exportar JSON
                </button>
                <button class="btn btn-outline" onclick="shareToServer()">
                    üîó Compartilhar
                </button>
            </div>
        </div>

        <div id="planList" class="content-card">
            <h2>üìã Meus Planos de Treino</h2>
            <div id="planListContent">
                <!-- Plans will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal for Exercise Editor -->
    <div id="exerciseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Exerc√≠cio</h2>
                <button class="close-btn" onclick="closeExerciseModal()">&times;</button>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Nome do Exerc√≠cio</label>
                    <input type="text" id="exerciseName" class="form-input" placeholder="Supino Reto">
                </div>
                <div class="form-group">
                    <label class="form-label">S√©ries</label>
                    <input type="number" id="exerciseSets" class="form-input" placeholder="4" min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Repeti√ß√µes</label>
                    <input type="text" id="exerciseReps" class="form-input" placeholder="8-12">
                </div>
                <div class="form-group">
                    <label class="form-label">Carga</label>
                    <input type="text" id="exerciseWeight" class="form-input" placeholder="80kg">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Descri√ß√£o/T√©cnica</label>
                <textarea id="exerciseDescription" class="form-textarea" placeholder="Instru√ß√µes t√©cnicas do exerc√≠cio..."></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveExercise()">üíæ Salvar</button>
                <button class="btn btn-outline" onclick="closeExerciseModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="importFile" class="file-input" accept=".json" onchange="importPlan(event)">

    <!-- Floating Action Button -->
    <button class="floating-action" onclick="scrollToTop()" title="Voltar ao topo">
        ‚Üë
    </button>

    <script>
        // Exercise database for AI generation
        const exerciseDatabase = {
            peito: {
                iniciante: [
                    { nome: 'Flex√£o de Bra√ßos', series: 3, repeticoes: '8-12', carga: 'Peso corporal', descricao: 'Posi√ß√£o de prancha, descer o peito at√© quase tocar o ch√£o' },
                    { nome: 'Supino com Halteres', series: 3, repeticoes: '10-12', carga: '12-15kg cada', descricao: 'Deitado no banco, empurrar halteres para cima' },
                    { nome: 'Crucifixo com Halteres', series: 3, repeticoes: '12-15', carga: '8-10kg cada', descricao: 'Abrir e fechar os bra√ßos em movimento de abra√ßo' }
                ],
                intermediario: [
                    { nome: 'Supino Reto com Barra', series: 4, repeticoes: '8-10', carga: '40-60kg', descricao: 'Exerc√≠cio fundamental para desenvolvimento do peitoral' },
                    { nome: 'Supino Inclinado', series: 3, repeticoes: '10-12', carga: '30-45kg', descricao: 'Trabalha a parte superior do peitoral' },
                    { nome: 'Crossover', series: 3, repeticoes: '12-15', carga: '15-25kg', descricao: 'Movimento de cruz trabalhando defini√ß√£o' }
                ],
                avancado: [
                    { nome: 'Supino Reto com Barra', series: 4, repeticoes: '6-8', carga: '60-80kg', descricao: 'Foco em for√ßa e massa muscular' },
                    { nome: 'Supino Inclinado com Halteres', series: 4, repeticoes: '8-10', carga: '22-28kg cada', descricao: 'Maior amplitude de movimento' },
                    { nome: 'Mergulho em Paralelas', series: 3, repeticoes: '8-12', carga: 'Peso corporal + 10-20kg', descricao: 'Exerc√≠cio composto para peitoral inferior' }
                ]
            },
            costas: {
                iniciante: [
                    { nome: 'Puxada Frontal', series: 3, repeticoes: '10-12', carga: '30-40kg', descricao: 'Puxar barra at√© o peito, contrair esc√°pulas' },
                    { nome: 'Remada Baixa', series: 3, repeticoes: '10-12', carga: '25-35kg', descricao: 'Puxar cabo em dire√ß√£o ao abd√¥men' },
                    { nome: 'Remada com Halter', series: 3, repeticoes: '10-12', carga: '12-16kg', descricao: 'Apoiar joelho no banco, remar halter' }
                ],
                intermediario: [
                    { nome: 'Puxada Frontal', series: 4, repeticoes: '8-10', carga: '45-60kg', descricao: 'Desenvolvimento do lat√≠ssimo do dorso' },
                    { nome: 'Remada Curvada', series: 4, repeticoes: '8-10', carga: '35-50kg', descricao: 'Inclinar tronco, remar barra ao abd√¥men' },
                    { nome: 'Pullover', series: 3, repeticoes: '12-15', carga: '15-20kg', descricao: 'Alongamento e contra√ß√£o do lat√≠ssimo' }
                ],
                avancado: [
                    { nome: 'Barra Fixa', series: 4, repeticoes: '6-10', carga: 'Peso corporal + 10-20kg', descricao: 'Exerc√≠cio funcional de peso corporal' },
                    { nome: 'Remada T-Bar', series: 4, repeticoes: '8-10', carga: '40-60kg', descricao: 'Trabalha espessura das costas' },
                    { nome: 'Levantamento Terra', series: 4, repeticoes: '6-8', carga: '80-120kg', descricao: 'Exerc√≠cio completo para posterior' }
                ]
            },
            ombros: {
                iniciante: [
                    { nome: 'Desenvolvimento com Halteres', series: 3, repeticoes: '10-12', carga: '8-12kg cada', descricao: 'Elevar halteres acima da cabe√ßa' },
                    { nome: 'Eleva√ß√£o Lateral', series: 3, repeticoes: '12-15', carga: '4-6kg cada', descricao: 'Trabalha deltoide medial' },
                    { nome: 'Eleva√ß√£o Frontal', series: 3, repeticoes: '12-15', carga: '4-6kg cada', descricao: 'Foco no deltoide anterior' }
                ],
                intermediario: [
                    { nome: 'Desenvolvimento com Barra', series: 4, repeticoes: '8-10', carga: '25-35kg', descricao: 'Exerc√≠cio base para ombros' },
                    { nome: 'Eleva√ß√£o Lateral', series: 3, repeticoes: '12-15', carga: '6-8kg cada', descricao: 'Defini√ß√£o lateral dos ombros' },
                    { nome: 'Eleva√ß√£o Posterior', series: 3, repeticoes: '12-15', carga: '4-6kg cada', descricao: 'Trabalha deltoide posterior' }
                ],
                avancado: [
                    { nome: 'Desenvolvimento Arnold', series: 4, repeticoes: '8-10', carga: '14-18kg cada', descricao: 'Movimento completo de rota√ß√£o' },
                    { nome: 'Eleva√ß√£o Lateral 21', series: 3, repeticoes: '21 (7+7+7)', carga: '6-8kg cada', descricao: 'M√©todo 21 para intensidade' },
                    { nome: 'Face Pull', series: 3, repeticoes: '15-20', carga: '15-25kg', descricao: 'Trabalha deltoide posterior e trap√©zio' }
                ]
            },
            biceps: {
                iniciante: [
                    { nome: 'Rosca Direta', series: 3, repeticoes: '10-12', carga: '15-20kg', descricao: 'Exerc√≠cio b√°sico para b√≠ceps' },
                    { nome: 'Rosca Alternada', series: 3, repeticoes: '10-12', carga: '8-10kg cada', descricao: 'Alternando bra√ßos para melhor controle' },
                    { nome: 'Rosca Martelo', series: 3, repeticoes: '12-15', carga: '6-8kg cada', descricao: 'Trabalha b√≠ceps e antebra√ßo' }
                ],
                intermediario: [
                    { nome: 'Rosca Direta', series: 4, repeticoes: '8-10', carga: '25-35kg', descricao: 'Foco em for√ßa e massa' },
                    { nome: 'Rosca Scott', series: 3, repeticoes: '10-12', carga: '20-25kg', descricao: 'Isolamento do b√≠ceps' },
                    { nome: 'Rosca 21', series: 3, repeticoes: '21 (7+7+7)', carga: '15-20kg', descricao: 'M√©todo intenso de treinamento' }
                ],
                avancado: [
                    { nome: 'Rosca Direta Pegada Fechada', series: 4, repeticoes: '6-8', carga: '30-40kg', descricao: 'Varia√ß√£o para for√ßa m√°xima' },
                    { nome: 'Rosca Spider', series: 3, repeticoes: '8-10', carga: '15-20kg', descricao: 'Isolamento total do b√≠ceps' },
                    { nome: 'Rosca Drag Curl', series: 3, repeticoes: '10-12', carga: '20-25kg', descricao: 'T√©cnica avan√ßada de execu√ß√£o' }
                ]
            },
            triceps: {
                iniciante: [
                    { nome: 'Tr√≠ceps Testa', series: 3, repeticoes: '10-12', carga: '15-20kg', descricao: 'Flexionar apenas antebra√ßos' },
                    { nome: 'Tr√≠ceps Pulley', series: 3, repeticoes: '12-15', carga: '20-25kg', descricao: 'Movimento de extens√£o no cabo' },
                    { nome: 'Mergulho no Banco', series: 3, repeticoes: '8-12', carga: 'Peso corporal', descricao: 'Exerc√≠cio funcional' }
                ],
                intermediario: [
                    { nome: 'Tr√≠ceps Franc√™s', series: 4, repeticoes: '8-10', carga: '20-30kg', descricao: 'Exerc√≠cio cl√°ssico para tr√≠ceps' },
                    { nome: 'Tr√≠ceps Corda', series: 3, repeticoes: '10-12', carga: '25-35kg', descricao: 'Maior amplitude de movimento' },
                    { nome: 'Supino Fechado', series: 3, repeticoes: '8-10', carga: '30-40kg', descricao: 'Exerc√≠cio composto' }
                ],
                avancado: [
                    { nome: 'Tr√≠ceps Franc√™s com Halter', series: 4, repeticoes: '6-8', carga: '18-25kg', descricao: 'Varia√ß√£o unilateral' },
                    { nome: 'Mergulho em Paralelas', series: 4, repeticoes: '8-12', carga: 'Peso corporal + 10-15kg', descricao: 'Exerc√≠cio funcional avan√ßado' },
                    { nome: 'JM Press', series: 3, repeticoes: '8-10', carga: '25-35kg', descricao: 'T√©cnica espec√≠fica para for√ßa' }
                ]
            },
            quadriceps: {
                iniciante: [
                    { nome: 'Agachamento Livre', series: 3, repeticoes: '12-15', carga: '20-30kg', descricao: 'Exerc√≠cio fundamental para pernas' },
                    { nome: 'Leg Press', series: 3, repeticoes: '12-15', carga: '80-100kg', descricao: 'Exerc√≠cio seguro para iniciantes' },
                    { nome: 'Extens√£o de Pernas', series: 3, repeticoes: '15-20', carga: '20-30kg', descricao: 'Isolamento do quadr√≠ceps' }
                ],
                intermediario: [
                    { nome: 'Agachamento Livre', series: 4, repeticoes: '8-12', carga: '40-60kg', descricao: 'Aumento de carga e intensidade' },
                    { nome: 'Leg Press 45¬∞', series: 4, repeticoes: '10-12', carga: '120-160kg', descricao: 'Varia√ß√£o angular' },
                    { nome: 'Afundo', series: 3, repeticoes: '12 cada perna', carga: '8-12kg cada', descricao: 'Exerc√≠cio unilateral' }
                ],
                avancado: [
                    { nome: 'Agachamento Livre', series: 4, repeticoes: '6-8', carga: '70-100kg', descricao: 'Foco em for√ßa m√°xima' },
                    { nome: 'Agachamento Frontal', series: 4, repeticoes: '8-10', carga: '40-60kg', descricao: 'Varia√ß√£o t√©cnica avan√ßada' },
                    { nome: 'Agachamento B√∫lgaro', series: 3, repeticoes: '10-12 cada', carga: '12-16kg cada', descricao: 'Exerc√≠cio unilateral desafiador' }
                ]
            },
            posterior: {
                iniciante: [
                    { nome: 'Stiff', series: 3, repeticoes: '10-12', carga: '20-30kg', descricao: 'Exerc√≠cio para posterior de coxa' },
                    { nome: 'Flex√£o de Pernas', series: 3, repeticoes: '12-15', carga: '20-30kg', descricao: 'Isolamento dos isquiotibiais' },
                    { nome: 'Eleva√ß√£o P√©lvica', series: 3, repeticoes: '15-20', carga: 'Peso corporal', descricao: 'Trabalha gl√∫teos' }
                ],
                intermediario: [
                    { nome: 'Stiff com Barra', series: 4, repeticoes: '8-10', carga: '35-50kg', descricao: 'Vers√£o mais intensa' },
                    { nome: 'Mesa Flexora', series: 3, repeticoes: '10-12', carga: '30-40kg', descricao: 'Isolamento na m√°quina' },
                    { nome: 'Good Morning', series: 3, repeticoes: '10-12', carga: '20-30kg', descricao: 'Exerc√≠cio t√©cnico' }
                ],
                avancado: [
                    { nome: 'Levantamento Terra', series: 4, repeticoes: '6-8', carga: '80-120kg', descricao: 'Exerc√≠cio completo de for√ßa' },
                    { nome: 'Stiff Unilateral', series: 3, repeticoes: '10-12 cada', carga: '15-20kg cada', descricao: 'Vers√£o unilateral' },
                    { nome: 'Hip Thrust', series: 3, repeticoes: '10-12', carga: '40-60kg', descricao: 'Foco nos gl√∫teos' }
                ]
            },
            panturrilha: {
                iniciante: [
                    { nome: 'Panturrilha Sentado', series: 3, repeticoes: '15-20', carga: '20-30kg', descricao: 'Trabalha s√≥leo' },
                    { nome: 'Panturrilha em P√©', series: 3, repeticoes: '15-20', carga: '40-60kg', descricao: 'Trabalha gastrocn√™mio' }
                ],
                intermediario: [
                    { nome: 'Panturrilha Sentado', series: 4, repeticoes: '12-15', carga: '35-45kg', descricao: 'Maior intensidade' },
                    { nome: 'Panturrilha Leg Press', series: 3, repeticoes: '15-20', carga: '80-120kg', descricao: 'Varia√ß√£o no leg press' }
                ],
                avancado: [
                    { nome: 'Panturrilha Unilateral', series: 3, repeticoes: '12-15 cada', carga: '20-30kg cada', descricao: 'Trabalho unilateral' },
                    { nome: 'Panturrilha com Pausa', series: 4, repeticoes: '10-12', carga: '50-70kg', descricao: 'T√©cnica de pausa' }
                ]
            }
        };

        // Application State
        let currentPlan = {
            id: null,
            nome: '',
            aluno: {
                nome: '',
                idade: 25,
                altura: '1,75m',
                peso: '75kg'
            },
            dias: 1,
            dataInicio: '',
            dataFim: '',
            perfil: {
                objetivo: 'Hipertrofia e ganho de massa muscular'
            },
            observacoes: {
                frequencia: '',
                progressao: 'Aumente a carga gradualmente quando conseguir completar todas as repeti√ß√µes',
                descanso: '60-90 segundos entre s√©ries',
                hidratacao: 'Mantenha-se bem hidratado',
                alimentacao: 'Siga uma dieta balanceada',
                suplementacao: 'Consulte um nutricionista',
                sono: '7-9 horas de sono por noite',
                aquecimento: 'Sempre fa√ßa aquecimento antes do treino',
                tecnica: 'Priorize a execu√ß√£o correta',
                periodizacao: 'Varie o treino periodicamente',
                consulta: 'Acompanhamento profissional recomendado'
            },
            treinos: []
        };

        let savedPlans = [];
        let currentExerciseIndex = null;
        let currentWorkoutIndex = null;
        let aiGeneratedPlan = null;

        // Default workout templates
        const workoutTemplates = {
            A: { nome: 'A - Corpo Inteiro', foco: 'Treino completo' },
            B: { nome: 'B - Corpo Inteiro', foco: 'Treino completo alternativo' },
            C: { nome: 'C - Corpo Inteiro', foco: 'Treino de for√ßa' },
            D: { nome: 'D - Membros Inferiores', foco: 'Pernas e gl√∫teos' },
            E: { nome: 'E - Core e Cardio', foco: 'Abd√¥men e condicionamento' }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedPlans();
            setDefaultDates();
            showPlanList();
        });

        function setDefaultDates() {
            const today = new Date();
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + 6);
            
            const startInput = document.getElementById('planStartDate');
            const endInput = document.getElementById('planEndDate');
            
            if (startInput) startInput.value = today.toISOString().split('T')[0];
            if (endInput) endInput.value = endDate.toISOString().split('T')[0];
        }

        function showAIPlanCreator() {
            document.getElementById('aiPlanCreator').style.display = 'block';
            document.getElementById('planCreator').style.display = 'none';
            document.getElementById('planList').style.display = 'none';
        }

        function showPlanCreator() {
            document.getElementById('planCreator').style.display = 'block';
            document.getElementById('aiPlanCreator').style.display = 'none';
            document.getElementById('planList').style.display = 'none';
            resetPlanForm();
            selectPlanType(1, 'A');
        }

        function showPlanList() {
            document.getElementById('planCreator').style.display = 'none';
            document.getElementById('aiPlanCreator').style.display = 'none';
            document.getElementById('planList').style.display = 'block';
            renderPlanList();
        }

        function generateAIPlan() {
            // Get AI form data
            const aiData = {
                nome: document.getElementById('aiStudentName').value,
                idade: parseInt(document.getElementById('aiStudentAge').value) || 25,
                altura: document.getElementById('aiStudentHeight').value || '1,75m',
                peso: document.getElementById('aiStudentWeight').value || '75kg',
                objetivo: document.getElementById('aiPlanObjective').value,
                nivel: document.getElementById('aiExperienceLevel').value,
                dias: parseInt(document.getElementById('aiAvailableDays').value),
                tempo: parseInt(document.getElementById('aiSessionTime').value),
                equipamentos: document.getElementById('aiEquipment').value,
                foco: document.getElementById('aiMusclePreference').value,
                limitacoes: document.getElementById('aiLimitations').value,
                observacoes: document.getElementById('aiSpecialNotes').value
            };

            // Validation
            if (!aiData.nome) {
                showMessage('Por favor, preencha o nome do aluno', 'error');
                return;
            }

            // Show generating indicator
            const indicator = document.getElementById('generatingIndicator');
            const progressFill = document.getElementById('progressFill');
            indicator.classList.add('active');

            // Simulate AI generation with progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                progressFill.style.width = progress + '%';
            }, 200);

            // Generate plan after delay
            setTimeout(() => {
                clearInterval(progressInterval);
                progressFill.style.width = '100%';

                // Create AI-generated plan
                aiGeneratedPlan = createAIPlan(aiData);
                
                // Fill the manual form with AI data
                fillFormWithAIPlan(aiGeneratedPlan);
                
                // Hide indicator and show plan creator
                setTimeout(() => {
                    indicator.classList.remove('active');
                    showPlanCreator();
                    showMessage('Plano gerado com sucesso pela IA! Revise e ajuste conforme necess√°rio.', 'success');
                }, 500);

            }, 2000 + Math.random() * 2000); // 2-4 seconds
        }

        function createAIPlan(aiData) {
            const plan = {
                id: Date.now(),
                nome: `Plano ${aiData.objetivo.split(' ')[0]} - ${aiData.nome}`,
                aluno: {
                    nome: aiData.nome,
                    idade: aiData.idade,
                    altura: aiData.altura,
                    peso: aiData.peso
                },
                dias: aiData.dias,
                dataInicio: new Date().toISOString().split('T')[0],
                dataFim: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                perfil: {
                    objetivo: aiData.objetivo
                },
                observacoes: {
                    frequencia: `Treino ${aiData.dias}x por semana, ${aiData.tempo} minutos por sess√£o`,
                    progressao: getProgressionByLevel(aiData.nivel),
                    descanso: getRestByObjective(aiData.objetivo),
                    hidratacao: 'Mantenha-se bem hidratado durante todo o treino',
                    alimentacao: getNutritionByObjective(aiData.objetivo),
                    suplementacao: 'Consulte um nutricionista para suplementa√ß√£o adequada',
                    sono: '7-9 horas de sono por noite para recupera√ß√£o adequada',
                    aquecimento: 'Sempre fa√ßa 5-10 minutos de aquecimento antes do treino',
                    tecnica: 'Priorize sempre a execu√ß√£o correta sobre o peso utilizado',
                    periodizacao: 'Reavalie e ajuste o treino a cada 6-8 semanas',
                    consulta: 'Acompanhamento profissional recomendado',
                    limitacoes: aiData.limitacoes || '',
                    observacoesEspeciais: aiData.observacoes || ''
                },
                treinos: generateWorkoutsByAI(aiData)
            };

            return plan;
        }

        function generateWorkoutsByAI(aiData) {
            const workouts = [];
            const letters = ['A', 'B', 'C', 'D', 'E', 'F'];
            
            // Define workout splits based on days
            const workoutSplits = {
                2: [
                    { nome: 'A - Superior', grupos: ['peito', 'costas', 'ombros', 'biceps', 'triceps'] },
                    { nome: 'B - Inferior + Core', grupos: ['quadriceps', 'posterior', 'panturrilha'] }
                ],
                3: [
                    { nome: 'A - Peito/Tr√≠ceps', grupos: ['peito', 'triceps', 'ombros'] },
                    { nome: 'B - Costas/B√≠ceps', grupos: ['costas', 'biceps'] },
                    { nome: 'C - Pernas', grupos: ['quadriceps', 'posterior', 'panturrilha'] }
                ],
                4: [
                    { nome: 'A - Peito/Tr√≠ceps', grupos: ['peito', 'triceps'] },
                    { nome: 'B - Costas/B√≠ceps', grupos: ['costas', 'biceps'] },
                    { nome: 'C - Ombros', grupos: ['ombros'] },
                    { nome: 'D - Pernas', grupos: ['quadriceps', 'posterior', 'panturrilha'] }
                ],
                5: [
                    { nome: 'A - Peito', grupos: ['peito'] },
                    { nome: 'B - Costas', grupos: ['costas'] },
                    { nome: 'C - Ombros', grupos: ['ombros'] },
                    { nome: 'D - Bra√ßos', grupos: ['biceps', 'triceps'] },
                    { nome: 'E - Pernas', grupos: ['quadriceps', 'posterior', 'panturrilha'] }
                ]
            };

            const split = workoutSplits[aiData.dias] || workoutSplits[3];
            
            split.forEach((workout, index) => {
                const letter = letters[index];
                const exercises = [];
                
                workout.grupos.forEach(grupo => {
                    const groupExercises = exerciseDatabase[grupo]?.[aiData.nivel] || [];
                    const numExercises = getExerciseCountByGroup(grupo, aiData.tempo);
                    
                    // Select exercises randomly but ensure variety
                    const selectedExercises = selectExercisesForGroup(groupExercises, numExercises);
                    exercises.push(...selectedExercises.map(ex => ({
                        ...ex,
                        id: Date.now() + Math.random(),
                        concluido: false
                    })));
                });

                workouts.push({
                    id: letter,
                    nome: workout.nome,
                    foco: getWorkoutFocus(workout.grupos, aiData.objetivo),
                    exercicios: exercises,
                    concluido: false,
                    execucoes: 0
                });
            });

            return workouts;
        }

        function getProgressionByLevel(nivel) {
            const progressions = {
                iniciante: 'Aumente a carga em 2,5-5kg quando conseguir completar todas as repeti√ß√µes com facilidade',
                intermediario: 'Aumente a carga em 2,5-5kg ou adicione 1-2 repeti√ß√µes quando o treino estiver f√°cil',
                avancado: 'Utilize t√©cnicas avan√ßadas como drop-set, rest-pause e periodiza√ß√£o para progress√£o'
            };
            return progressions[nivel] || progressions.intermediario;
        }

        function getRestByObjective(objetivo) {
            if (objetivo.includes('For√ßa')) return '2-3 minutos entre s√©ries';
            if (objetivo.includes('Hipertrofia')) return '60-90 segundos entre s√©ries';
            if (objetivo.includes('Perda de peso')) return '30-60 segundos entre s√©ries';
            if (objetivo.includes('Resist√™ncia')) return '30-45 segundos entre s√©ries';
            return '60-90 segundos entre s√©ries';
        }

        function getNutritionByObjective(objetivo) {
            if (objetivo.includes('Hipertrofia')) return 'Dieta hipercal√≥rica com foco em prote√≠nas (1,6-2,2g/kg)';
            if (objetivo.includes('Perda de peso')) return 'Dieta hipocal√≥rica balanceada mantendo prote√≠nas altas';
            if (objetivo.includes('For√ßa')) return 'Dieta balanceada com adequada ingest√£o de carboidratos';
            return 'Dieta balanceada com foco em alimentos naturais e prote√≠nas adequadas';
        }

        function getExerciseCountByGroup(grupo, tempo) {
            // Adjust exercise count based on session time
            const baseCounts = {
                peito: tempo >= 75 ? 4 : tempo >= 60 ? 3 : 2,
                costas: tempo >= 75 ? 4 : tempo >= 60 ? 3 : 2,
                ombros: tempo >= 75 ? 3 : tempo >= 60 ? 3 : 2,
                biceps: tempo >= 75 ? 3 : 2,
                triceps: tempo >= 75 ? 3 : 2,
                quadriceps: tempo >= 75 ? 4 : tempo >= 60 ? 3 : 2,
                posterior: tempo >= 75 ? 3 : 2,
                panturrilha: 2
            };
            return baseCounts[grupo] || 2;
        }

        function selectExercisesForGroup(exercises, count) {
            if (exercises.length <= count) return exercises;
            
            // Shuffle and select
            const shuffled = [...exercises].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        function getWorkoutFocus(grupos, objetivo) {
            const groupNames = {
                peito: 'Peitoral',
                costas: 'Costas',
                ombros: 'Ombros',
                biceps: 'B√≠ceps',
                triceps: 'Tr√≠ceps',
                quadriceps: 'Quadr√≠ceps',
                posterior: 'Posterior',
                panturrilha: 'Panturrilha'
            };
            
            const focusNames = grupos.map(g => groupNames[g]).join(', ');
            return `${focusNames} - ${objetivo}`;
        }

        function fillFormWithAIPlan(plan) {
            // Fill student data
            document.getElementById('studentName').value = plan.aluno.nome;
            document.getElementById('studentAge').value = plan.aluno.idade;
            document.getElementById('studentHeight').value = plan.aluno.altura;
            document.getElementById('studentWeight').value = plan.aluno.peso;
            
            // Fill plan data
            document.getElementById('planName').value = plan.nome;
            document.getElementById('planObjective').value = plan.perfil.objetivo;
            document.getElementById('planStartDate').value = plan.dataInicio;
            document.getElementById('planEndDate').value = plan.dataFim;
            document.getElementById('planObservations').value = plan.observacoes.frequencia;

            // Update current plan
            currentPlan = { ...plan };

            // Generate workout editor with AI data
            const letters = ['A', 'B', 'C', 'D', 'E'].slice(0, plan.dias).join('');
            selectPlanType(plan.dias, letters);
            
            // Fill exercises for each workout
            setTimeout(() => {
                plan.treinos.forEach((workout, index) => {
                    // Update workout name and focus inputs
                    const workoutNameInput = document.querySelector(`#workoutEditor input[onchange*="updateWorkoutName(${index}"]`);
                    const workoutFocusInput = document.querySelector(`#workoutEditor input[onchange*="updateWorkoutFocus(${index}"]`);
                    
                    if (workoutNameInput) workoutNameInput.value = workout.nome;
                    if (workoutFocusInput) workoutFocusInput.value = workout.foco;
                    
                    renderExerciseList(index);
                });
            }, 100);
        }

        function resetPlanForm() {
            currentPlan = {
                id: Date.now(),
                nome: '',
                aluno: { nome: '', idade: 25, altura: '1,75m', peso: '75kg' },
                dias: 1,
                dataInicio: '',
                dataFim: '',
                perfil: { objetivo: 'Hipertrofia e ganho de massa muscular' },
                observacoes: {
                    frequencia: '',
                    progressao: 'Aumente a carga gradualmente quando conseguir completar todas as repeti√ß√µes',
                    descanso: '60-90 segundos entre s√©ries',
                    hidratacao: 'Mantenha-se bem hidratado',
                    alimentacao: 'Siga uma dieta balanceada',
                    suplementacao: 'Consulte um nutricionista',
                    sono: '7-9 horas de sono por noite',
                    aquecimento: 'Sempre fa√ßa aquecimento antes do treino',
                    tecnica: 'Priorize a execu√ß√£o correta',
                    periodizacao: 'Varie o treino periodicamente',
                    consulta: 'Acompanhamento profissional recomendado'
                },
                treinos: []
            };
            
            // Clear form fields
            const fields = ['studentName', 'studentAge', 'studentHeight', 'studentWeight', 'planName', 'planObservations'];
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element) element.value = '';
            });
            
            document.getElementById('planObjective').value = 'Hipertrofia e ganho de massa muscular';
            setDefaultDates();
        }

        function selectPlanType(days, letters) {
            // Update active button
            document.querySelectorAll('.plan-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.plan-type-btn').classList.add('active');
            
            currentPlan.dias = days;
            generateWorkouts(days, letters);
        }

        function generateWorkouts(days, letters) {
            const workoutEditor = document.getElementById('workoutEditor');
            currentPlan.treinos = [];
            
            let html = '<div class="form-section"><h2>üèãÔ∏è Configura√ß√£o dos Treinos</h2>';
            
            for (let i = 0; i < days; i++) {
                const letter = letters[i];
                const template = workoutTemplates[letter] || { nome: `${letter} - Treino ${i + 1}`, foco: 'Treino personalizado' };
                
                const workout = {
                    id: letter,
                    nome: template.nome,
                    foco: template.foco,
                    exercicios: [],
                    concluido: false,
                    execucoes: 0
                };
                
                currentPlan.treinos.push(workout);
                
                html += `
                    <div class="workout-editor">
                        <div class="workout-header">
                            <div class="workout-title">${letter} - ${template.nome}</div>
                            <button class="btn btn-small btn-primary" onclick="addExercise(${i})">‚ûï Adicionar Exerc√≠cio</button>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nome do Treino</label>
                                <input type="text" class="form-input" value="${template.nome}" onchange="updateWorkoutName(${i}, this.value)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Foco do Treino</label>
                                <input type="text" class="form-input" value="${template.foco}" onchange="updateWorkoutFocus(${i}, this.value)">
                            </div>
                        </div>
                        <div class="exercise-list" id="exerciseList${i}">
                            <!-- Exercises will be added here -->
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            workoutEditor.innerHTML = html;
        }

        function updateWorkoutName(index, name) {
            if (currentPlan.treinos[index]) {
                currentPlan.treinos[index].nome = name;
            }
        }

        function updateWorkoutFocus(index, focus) {
            if (currentPlan.treinos[index]) {
                currentPlan.treinos[index].foco = focus;
            }
        }

        function addExercise(workoutIndex) {
            currentWorkoutIndex = workoutIndex;
            currentExerciseIndex = null;
            
            // Clear modal form
            document.getElementById('exerciseName').value = '';
            document.getElementById('exerciseSets').value = '';
            document.getElementById('exerciseReps').value = '';
            document.getElementById('exerciseWeight').value = '';
            document.getElementById('exerciseDescription').value = '';
            
            document.getElementById('exerciseModal').classList.add('active');
        }

        function editExercise(workoutIndex, exerciseIndex) {
            currentWorkoutIndex = workoutIndex;
            currentExerciseIndex = exerciseIndex;
            
            const exercise = currentPlan.treinos[workoutIndex].exercicios[exerciseIndex];
            
            // Fill modal form
            document.getElementById('exerciseName').value = exercise.nome;
            document.getElementById('exerciseSets').value = exercise.series;
            document.getElementById('exerciseReps').value = exercise.repeticoes;
            document.getElementById('exerciseWeight').value = exercise.carga;
            document.getElementById('exerciseDescription').value = exercise.descricao || '';
            
            document.getElementById('exerciseModal').classList.add('active');
        }

        function saveExercise() {
            const exercise = {
                id: Date.now() + Math.random(),
                nome: document.getElementById('exerciseName').value,
                series: parseInt(document.getElementById('exerciseSets').value),
                repeticoes: document.getElementById('exerciseReps').value,
                carga: document.getElementById('exerciseWeight').value,
                descricao: document.getElementById('exerciseDescription').value,
                concluido: false
            };

            if (!exercise.nome || !exercise.series || !exercise.repeticoes || !exercise.carga) {
                showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            if (currentExerciseIndex !== null) {
                // Edit existing exercise
                currentPlan.treinos[currentWorkoutIndex].exercicios[currentExerciseIndex] = exercise;
            } else {
                // Add new exercise
                currentPlan.treinos[currentWorkoutIndex].exercicios.push(exercise);
            }

            closeExerciseModal();
            renderExerciseList(currentWorkoutIndex);
        }

        function deleteExercise(workoutIndex, exerciseIndex) {
            if (confirm('Tem certeza que deseja excluir este exerc√≠cio?')) {
                currentPlan.treinos[workoutIndex].exercicios.splice(exerciseIndex, 1);
                renderExerciseList(workoutIndex);
            }
        }

        function renderExerciseList(workoutIndex) {
            const exerciseList = document.getElementById(`exerciseList${workoutIndex}`);
            const exercises = currentPlan.treinos[workoutIndex].exercicios;

            if (exercises.length === 0) {
                exerciseList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Nenhum exerc√≠cio adicionado ainda</p>';
                return;
            }

            let html = '';
            exercises.forEach((exercise, index) => {
                html += `
                    <div class="exercise-item">
                        <div class="exercise-info">
                            <div>
                                <strong>${exercise.nome}</strong>
                                ${exercise.descricao ? `<br><small style="color: #666;">${exercise.descricao}</small>` : ''}
                            </div>
                            <div>${exercise.series} s√©ries</div>
                            <div>${exercise.repeticoes} reps</div>
                            <div>${exercise.carga}</div>
                        </div>
                        <div class="exercise-actions">
                            <button class="btn btn-small btn-secondary" onclick="editExercise(${workoutIndex}, ${index})">‚úèÔ∏è</button>
                            <button class="btn btn-small btn-danger" onclick="deleteExercise(${workoutIndex}, ${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });

            exerciseList.innerHTML = html;
        }

        function closeExerciseModal() {
            document.getElementById('exerciseModal').classList.remove('active');
        }

        function savePlan() {
            // Get form data
            currentPlan.aluno.nome = document.getElementById('studentName').value;
            currentPlan.aluno.idade = parseInt(document.getElementById('studentAge').value) || 25;
            currentPlan.aluno.altura = document.getElementById('studentHeight').value || '1,75m';
            currentPlan.aluno.peso = document.getElementById('studentWeight').value || '75kg';
            currentPlan.nome = document.getElementById('planName').value;
            currentPlan.perfil.objetivo = document.getElementById('planObjective').value;
            currentPlan.dataInicio = document.getElementById('planStartDate').value;
            currentPlan.dataFim = document.getElementById('planEndDate').value;
            
            const observations = document.getElementById('planObservations').value;
            if (observations) {
                currentPlan.observacoes.frequencia = observations;
            }

            // Validation
            if (!currentPlan.aluno.nome || !currentPlan.nome) {
                showMessage('Por favor, preencha o nome do aluno e nome do plano', 'error');
                return;
            }

            // Check if plan has exercises
            const hasExercises = currentPlan.treinos.some(workout => workout.exercicios.length > 0);
            if (!hasExercises) {
                if (!confirm('Este plano n√£o possui exerc√≠cios. Deseja salvar mesmo assim?')) {
                    return;
                }
            }

            // Update plan in list or add new
            const existingIndex = savedPlans.findIndex(p => p.id === currentPlan.id);
            if (existingIndex >= 0) {
                savedPlans[existingIndex] = { ...currentPlan };
            } else {
                savedPlans.push({ ...currentPlan });
            }

            // Save to localStorage
            localStorage.setItem('jsfitapp_plans', JSON.stringify(savedPlans));
            
            showMessage('Plano salvo com sucesso!', 'success');
        }

        function exportPlan() {
            savePlan(); // Save current changes first
            
            // Create export format compatible with the original structure
            const exportData = {
                planos: [{
                    id: currentPlan.id,
                    nome: currentPlan.nome,
                    aluno: currentPlan.aluno,
                    dias: currentPlan.dias,
                    dataInicio: currentPlan.dataInicio,
                    dataFim: currentPlan.dataFim,
                    perfil: {
                        idade: currentPlan.aluno.idade,
                        altura: currentPlan.aluno.altura,
                        peso: currentPlan.aluno.peso,
                        porte: getPorteFisico(currentPlan.aluno.peso),
                        objetivo: currentPlan.perfil.objetivo
                    },
                    treinos: currentPlan.treinos.map(treino => ({
                        ...treino,
                        exercicios: treino.exercicios.map(ex => ({
                            ...ex,
                            concluido: false
                        })),
                        concluido: false,
                        execucoes: 0
                    })),
                    observacoes: currentPlan.observacoes
                }]
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = `plano-treino-${currentPlan.nome.toLowerCase().replace(/\s+/g, '-')}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            URL.revokeObjectURL(url);
            showMessage('Plano exportado com sucesso!', 'success');
        }

        function shareToServer() {
            savePlan(); // Save current changes first
            
            if (!currentPlan.nome || !currentPlan.aluno.nome) {
                showMessage('Salve o plano antes de compartilhar', 'error');
                return;
            }

            // Generate share ID
            const shareId = generateShareId();
            
            // Copy share ID to clipboard
            copyToClipboard(shareId);
            showMessage(`Plano compartilhado! ID: ${shareId} (copiado para √°rea de transfer√™ncia)`, 'success');
        }

        function generateShareId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        function importPlan(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    let planData;

                    // Handle different JSON formats
                    if (data.planos && Array.isArray(data.planos) && data.planos.length > 0) {
                        planData = data.planos[0];
                    } else if (data.plan) {
                        planData = data.plan;
                    } else {
                        planData = data;
                    }

                    // Convert to our format
                    currentPlan = {
                        id: Date.now(),
                        nome: planData.nome + ' - Importado',
                        aluno: {
                            nome: planData.aluno?.nome || 'Aluno Importado',
                            idade: planData.perfil?.idade || planData.aluno?.idade || 25,
                            altura: planData.perfil?.altura || planData.aluno?.altura || '1,75m',
                            peso: planData.perfil?.peso || planData.aluno?.peso || '75kg'
                        },
                        dias: planData.dias || 1,
                        dataInicio: planData.dataInicio || new Date().toISOString().split('T')[0],
                        dataFim: planData.dataFim || new Date(Date.now() + 180 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        perfil: {
                            objetivo: planData.perfil?.objetivo || 'Hipertrofia e ganho de massa muscular'
                        },
                        observacoes: planData.observacoes || {
                            frequencia: 'Plano importado',
                            progressao: 'Aumente a carga gradualmente',
                            descanso: '60-90 segundos entre s√©ries',
                            hidratacao: 'Mantenha-se bem hidratado',
                            alimentacao: 'Siga uma dieta balanceada',
                            suplementacao: 'Consulte um nutricionista',
                            sono: '7-9 horas de sono por noite',
                            aquecimento: 'Sempre fa√ßa aquecimento antes do treino',
                            tecnica: 'Priorize a execu√ß√£o correta',
                            periodizacao: 'Varie o treino periodicamente',
                            consulta: 'Acompanhamento profissional recomendado'
                        },
                        treinos: planData.treinos ? planData.treinos.map(treino => ({
                            id: treino.id,
                            nome: treino.nome,
                            foco: treino.foco,
                            exercicios: treino.exercicios ? treino.exercicios.map(ex => ({
                                id: ex.id || Date.now() + Math.random(),
                                nome: ex.nome,
                                descricao: ex.descricao || '',
                                series: ex.series || 3,
                                repeticoes: ex.repeticoes || '12',
                                carga: ex.carga || '20kg',
                                concluido: false
                            })) : [],
                            concluido: false,
                            execucoes: 0
                        })) : []
                    };

                    // Fill form with imported data
                    fillFormWithPlan(currentPlan);
                    showPlanCreator();
                    showMessage('Plano importado com sucesso!', 'success');

                } catch (error) {
                    console.error('Erro ao importar:', error);
                    showMessage('Erro ao importar arquivo. Verifique o formato.', 'error');
                }
            };

            reader.readAsText(file);
            event.target.value = '';
        }

        function fillFormWithPlan(plan) {
            document.getElementById('studentName').value = plan.aluno.nome;
            document.getElementById('studentAge').value = plan.aluno.idade;
            document.getElementById('studentHeight').value = plan.aluno.altura;
            document.getElementById('studentWeight').value = plan.aluno.peso;
            document.getElementById('planName').value = plan.nome;
            document.getElementById('planObjective').value = plan.perfil.objetivo;
            document.getElementById('planStartDate').value = plan.dataInicio;
            document.getElementById('planEndDate').value = plan.dataFim;
            document.getElementById('planObservations').value = plan.observacoes.frequencia || '';

            // Update plan type selector
            const letters = ['A', 'B', 'C', 'D', 'E'].slice(0, plan.dias).join('');
            selectPlanType(plan.dias, letters);
            
            // Render exercises for each workout
            setTimeout(() => {
                plan.treinos.forEach((workout, index) => {
                    renderExerciseList(index);
                });
            }, 100);
        }

        function renderPlanList() {
            const container = document.getElementById('planListContent');
            
            if (savedPlans.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">üìã</div>
                        <h3>Nenhum plano salvo</h3>
                        <p>Crie seu primeiro plano de treino</p>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-ai" onclick="showAIPlanCreator()" style="margin: 5px;">
                                ü§ñ Criar com IA
                            </button>
                            <button class="btn btn-primary" onclick="showPlanCreator()" style="margin: 5px;">
                                ‚úèÔ∏è Criar Manualmente
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            let html = '<div style="display: grid; gap: 20px;">';
            
            savedPlans.forEach((plan, index) => {
                const totalExercises = plan.treinos.reduce((sum, workout) => sum + workout.exercicios.length, 0);
                const planTypeColor = plan.nome.includes('IA') ? '#ff6b6b' : '#7945ff';
                
                html += `
                    <div style="background: white; border-radius: 15px; padding: 20px; border: 2px solid #e2e8f0; position: relative;">
                        ${plan.nome.includes('IA') ? '<div style="position: absolute; top: 10px; right: 15px; background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.8rem; font-weight: 600;">ü§ñ IA</div>' : ''}
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h3 style="margin: 0 0 5px 0; color: #333; padding-right: 60px;">${plan.nome}</h3>
                                <p style="margin: 0; color: #666;">üë§ ${plan.aluno.nome} ‚Ä¢ ${plan.aluno.idade} anos ‚Ä¢ ${plan.aluno.altura} ‚Ä¢ ${plan.aluno.peso}</p>
                                <p style="margin: 5px 0 0 0; color: #666;">üìÖ ${plan.dias} dias ‚Ä¢ ${totalExercises} exerc√≠cios</p>
                                <p style="margin: 5px 0 0 0; color: ${planTypeColor}; font-weight: 600;">${plan.perfil.objetivo}</p>
                            </div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn btn-small btn-secondary" onclick="editPlan(${index})" title="Editar">‚úèÔ∏è</button>
                                <button class="btn btn-small btn-primary" onclick="duplicatePlan(${index})" title="Duplicar">üìã</button>
                                <button class="btn btn-small btn-outline" onclick="exportSavedPlan(${index})" title="Exportar">üì§</button>
                                <button class="btn btn-small btn-danger" onclick="deletePlan(${index})" title="Excluir">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div style="background: #f8fafc; border-radius: 8px; padding: 15px;">
                            <h4 style="margin: 0 0 10px 0; font-size: 0.9rem; color: #666;">Treinos:</h4>
                            ${plan.treinos.map(workout => 
                                `<div style="margin-bottom: 8px; display: flex; justify-content: space-between;">
                                    <span><strong>${workout.nome}</strong></span>
                                    <span style="color: #666;">${workout.exercicios.length} exerc√≠cios</span>
                                </div>`
                            ).join('')}
                            ${plan.observacoes?.frequencia ? `<div style="margin-top: 10px; padding: 8px; background: rgba(121, 69, 255, 0.1); border-radius: 6px; font-size: 0.85rem; color: #5a4fcf;"><strong>Observa√ß√µes:</strong> ${plan.observacoes.frequencia}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function editPlan(index) {
            currentPlan = { ...savedPlans[index] };
            fillFormWithPlan(currentPlan);
            showPlanCreator();
        }

        function duplicatePlan(index) {
            const original = savedPlans[index];
            currentPlan = {
                ...original,
                id: Date.now(),
                nome: original.nome + ' - C√≥pia'
            };
            fillFormWithPlan(currentPlan);
            showPlanCreator();
            showMessage('Plano duplicado! Fa√ßa as altera√ß√µes necess√°rias.', 'success');
        }

        function exportSavedPlan(index) {
            const plan = savedPlans[index];
            
            const exportData = {
                planos: [{
                    id: plan.id,
                    nome: plan.nome,
                    aluno: plan.aluno,
                    dias: plan.dias,
                    dataInicio: plan.dataInicio,
                    dataFim: plan.dataFim,
                    perfil: {
                        idade: plan.aluno.idade,
                        altura: plan.aluno.altura,
                        peso: plan.aluno.peso,
                        porte: getPorteFisico(plan.aluno.peso),
                        objetivo: plan.perfil.objetivo
                    },
                    treinos: plan.treinos,
                    observacoes: plan.observacoes
                }]
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = `plano-treino-${plan.nome.toLowerCase().replace(/\s+/g, '-')}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            URL.revokeObjectURL(url);
            showMessage('Plano exportado com sucesso!', 'success');
        }

        function deletePlan(index) {
            if (confirm('Tem certeza que deseja excluir este plano? Esta a√ß√£o n√£o pode ser desfeita.')) {
                savedPlans.splice(index, 1);
                localStorage.setItem('jsfitapp_plans', JSON.stringify(savedPlans));
                renderPlanList();
                showMessage('Plano exclu√≠do com sucesso!', 'success');
            }
        }

        function loadSavedPlans() {
            try {
                const saved = localStorage.getItem('jsfitapp_plans');
                if (saved) {
                    savedPlans = JSON.parse(saved);
                }
            } catch (error) {
                console.error('Erro ao carregar planos:', error);
                savedPlans = [];
            }
        }

        function getPorteFisico(peso) {
            const weight = parseFloat(peso.replace('kg', ''));
            if (weight < 70) return 'pequeno';
            if (weight > 85) return 'grande';
            return 'medio';
        }

        function showMessage(message, type) {
            // Remove existing messages
            document.querySelectorAll('.success-message, .error-message').forEach(el => el.remove());
            
            const messageEl = document.createElement('div');
            messageEl.className = type === 'success' ? 'success-message' : 'error-message';
            messageEl.innerHTML = `
                <span>${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                <span>${message}</span>
            `;
            
            // Add to top of container
            const container = document.querySelector('.container');
            container.insertBefore(messageEl, container.firstChild);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.remove();
                }
            }, 5000);

            // Scroll to top to show message
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('exerciseModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeExerciseModal();
                    }
                });
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeExerciseModal();
            }
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                savePlan();
            }
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                showPlanCreator();
            }
            if (e.ctrlKey && e.key === 'i') {
                e.preventDefault();
                showAIPlanCreator();
            }
        });

        // Auto-save functionality
        let autoSaveTimeout;
        function setupAutoSave() {
            // Auto-save every 2 minutes if there are changes
            const inputs = document.querySelectorAll('#planCreator input, #planCreator select, #planCreator textarea');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(autoSaveTimeout);
                    autoSaveTimeout = setTimeout(() => {
                        if (currentPlan.aluno.nome && currentPlan.nome) {
                            savePlan();
                            showMessage('Plano salvo automaticamente', 'success');
                        }
                    }, 120000); // 2 minutes
                });
            });
        }

        // Enhanced plan validation
        function validatePlan(plan) {
            const errors = [];

            if (!plan.aluno.nome.trim()) {
                errors.push('Nome do aluno √© obrigat√≥rio');
            }

            if (!plan.nome.trim()) {
                errors.push('Nome do plano √© obrigat√≥rio');
            }

            if (plan.aluno.idade < 15 || plan.aluno.idade > 100) {
                errors.push('Idade deve estar entre 15 e 100 anos');
            }

            if (!plan.dataInicio) {
                errors.push('Data de in√≠cio √© obrigat√≥ria');
            }

            if (!plan.dataFim) {
                errors.push('Data de fim √© obrigat√≥ria');
            }

            if (plan.dataInicio && plan.dataFim && new Date(plan.dataInicio) >= new Date(plan.dataFim)) {
                errors.push('Data de fim deve ser posterior √† data de in√≠cio');
            }

            // Validate each workout has at least one exercise
            const emptyWorkouts = plan.treinos.filter(workout => workout.exercicios.length === 0);
            if (emptyWorkouts.length > 0) {
                errors.push(`${emptyWorkouts.length} treino(s) sem exerc√≠cios`);
            }

            return errors;
        }

        // Enhanced save with validation
        function savePlanWithValidation() {
            // Update current plan with form data first
            savePlan();

            const errors = validatePlan(currentPlan);
            if (errors.length > 0) {
                showMessage('Problemas encontrados: ' + errors.join(', '), 'error');
                return false;
            }

            return true;
        }

        // Add exercise suggestions based on muscle group
        function addExerciseSuggestion(workoutIndex) {
            currentWorkoutIndex = workoutIndex;
            const workout = currentPlan.treinos[workoutIndex];
            
            // Simple AI suggestion based on workout name
            let suggestedGroup = 'peito'; // default
            
            if (workout.nome.toLowerCase().includes('peito')) suggestedGroup = 'peito';
            else if (workout.nome.toLowerCase().includes('costas')) suggestedGroup = 'costas';
            else if (workout.nome.toLowerCase().includes('ombro')) suggestedGroup = 'ombros';
            else if (workout.nome.toLowerCase().includes('bra√ßo') || workout.nome.toLowerCase().includes('biceps')) suggestedGroup = 'biceps';
            else if (workout.nome.toLowerCase().includes('triceps')) suggestedGroup = 'triceps';
            else if (workout.nome.toLowerCase().includes('perna') || workout.nome.toLowerCase().includes('quadriceps')) suggestedGroup = 'quadriceps';
            else if (workout.nome.toLowerCase().includes('posterior')) suggestedGroup = 'posterior';

            const exercises = exerciseDatabase[suggestedGroup]?.intermediario || exerciseDatabase.peito.intermediario;
            const randomExercise = exercises[Math.floor(Math.random() * exercises.length)];

            // Pre-fill modal with suggestion
            document.getElementById('exerciseName').value = randomExercise.nome;
            document.getElementById('exerciseSets').value = randomExercise.series;
            document.getElementById('exerciseReps').value = randomExercise.repeticoes;
            document.getElementById('exerciseWeight').value = randomExercise.carga;
            document.getElementById('exerciseDescription').value = randomExercise.descricao;

            currentExerciseIndex = null;
            document.getElementById('exerciseModal').classList.add('active');
        }

        // Bulk operations for exercises
        function duplicateWorkout(workoutIndex) {
            if (confirm('Duplicar este treino?')) {
                const original = currentPlan.treinos[workoutIndex];
                const duplicate = {
                    ...original,
                    id: original.id + '_copy',
                    nome: original.nome + ' - C√≥pia',
                    exercicios: original.exercicios.map(ex => ({
                        ...ex,
                        id: Date.now() + Math.random()
                    }))
                };

                currentPlan.treinos.push(duplicate);
                currentPlan.dias = currentPlan.treinos.length;
                
                // Regenerate workout editor
                const letters = ['A', 'B', 'C', 'D', 'E', 'F'].slice(0, currentPlan.dias).join('');
                generateWorkouts(currentPlan.dias, letters);
                
                showMessage('Treino duplicado com sucesso!', 'success');
            }
        }

        function clearAllExercises(workoutIndex) {
            if (confirm('Excluir todos os exerc√≠cios deste treino?')) {
                currentPlan.treinos[workoutIndex].exercicios = [];
                renderExerciseList(workoutIndex);
                showMessage('Todos os exerc√≠cios foram removidos', 'success');
            }
        }

        // Enhanced UI interactions
        function showPlanPreview() {
            const preview = generatePlanPreview(currentPlan);
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2>üìã Pr√©via do Plano</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div style="max-height: 70vh; overflow-y: auto;">
                        ${preview}
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="savePlan(); this.closest('.modal').remove();">
                            üíæ Salvar Plano
                        </button>
                        <button class="btn btn-outline" onclick="this.closest('.modal').remove();">
                            ‚ùå Fechar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function generatePlanPreview(plan) {
            let html = `
                <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>${plan.nome}</h3>
                    <p><strong>Aluno:</strong> ${plan.aluno.nome}, ${plan.aluno.idade} anos, ${plan.aluno.altura}, ${plan.aluno.peso}</p>
                    <p><strong>Objetivo:</strong> ${plan.perfil.objetivo}</p>
                    <p><strong>Per√≠odo:</strong> ${plan.dataInicio} at√© ${plan.dataFim}</p>
                    <p><strong>Frequ√™ncia:</strong> ${plan.dias} dias por semana</p>
                </div>
            `;

            plan.treinos.forEach(treino => {
                html += `
                    <div style="background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                        <h4 style="color: #7945ff; margin-bottom: 10px;">${treino.nome}</h4>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">${treino.foco}</p>
                        ${treino.exercicios.map(ex => `
                            <div style="border-left: 3px solid #7945ff; padding-left: 10px; margin-bottom: 10px;">
                                <strong>${ex.nome}</strong> - ${ex.series} s√©ries x ${ex.repeticoes} repeti√ß√µes
                                <br><small style="color: #666;">Carga: ${ex.carga}</small>
                                ${ex.descricao ? `<br><small style="color: #888;">${ex.descricao}</small>` : ''}
                            </div>
                        `).join('')}
                        ${treino.exercicios.length === 0 ? '<p style="color: #999; font-style: italic;">Nenhum exerc√≠cio adicionado</p>' : ''}
                    </div>
                `;
            });

            return html;
        }

        // Initialize enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            setupAutoSave();
            
            // Add keyboard shortcut hints
            const hints = document.createElement('div');
            hints.style.cssText = 'position: fixed; bottom: 70px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 8px; font-size: 0.8rem; opacity: 0; transition: opacity 0.3s; z-index: 99;';
            hints.innerHTML = `
                <div><kbd>Ctrl+S</kbd> Salvar</div>
                <div><kbd>Ctrl+N</kbd> Novo Plano</div>
                <div><kbd>Ctrl+I</kbd> IA</div>
                <div><kbd>Esc</kbd> Fechar Modal</div>
            `;
            document.body.appendChild(hints);

            // Show hints on hover over floating button
            const floatingBtn = document.querySelector('.floating-action');
            if (floatingBtn) {
                floatingBtn.addEventListener('mouseenter', () => hints.style.opacity = '1');
                floatingBtn.addEventListener('mouseleave', () => hints.style.opacity = '0');
            }
        });

        // Export functionality enhancements
        function exportPlanAsPDF() {
            // Simple HTML to PDF conversion simulation
            const printWindow = window.open('', '_blank');
            const planHTML = generatePlanPreview(currentPlan);
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>${currentPlan.nome}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h3 { color: #7945ff; }
                        .exercise { border-left: 3px solid #7945ff; padding-left: 10px; margin: 10px 0; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <h1>üèãÔ∏è ${currentPlan.nome}</h1>
                    ${planHTML}
                    <footer style="margin-top: 40px; text-align: center; color: #666;">
                        <p>Gerado por JS Fit App - ${new Date().toLocaleDateString()}</p>
                    </footer>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => printWindow.print(), 500);
        }

        // Statistics and analytics
        function getPlanStatistics(plan) {
            const stats = {
                totalExercises: 0,
                totalSets: 0,
                muscleGroups: new Set(),
                avgExercisesPerWorkout: 0,
                estimatedDuration: 0
            };

            plan.treinos.forEach(treino => {
                stats.totalExercises += treino.exercicios.length;
                treino.exercicios.forEach(ex => {
                    stats.totalSets += ex.series;
                    // Estimate duration: 2 minutes per set + 1 minute per exercise setup
                    stats.estimatedDuration += (ex.series * 2) + 1;
                });
            });

            stats.avgExercisesPerWorkout = Math.round(stats.totalExercises / plan.treinos.length);
            
            return stats;
        }

        // Add plan comparison feature
        function comparePlans(plan1, plan2) {
            const comparison = {
                exercises: {
                    plan1: plan1.treinos.reduce((sum, w) => sum + w.exercicios.length, 0),
                    plan2: plan2.treinos.reduce((sum, w) => sum + w.exercicios.length, 0)
                },
                days: {
                    plan1: plan1.dias,
                    plan2: plan2.dias
                },
                objectives: {
                    plan1: plan1.perfil.objetivo,
                    plan2: plan2.perfil.objetivo
                }
            };

            return comparison;
        }
    </script>
</body>
</html>